var jquery_fineUploader={exports:{}};(function(module){(function(global){(function(e){var t,n=["uploaderType","endpointType"];function i(o){var u=f(o||{}),p=a(u);return l(p),c(u,p),t}function a(o){var u=s("uploaderType"),p=s("endpointType");return u?(u=u.charAt(0).toUpperCase()+u.slice(1).toLowerCase(),p?new qq[p]["FineUploader"+u](o):new qq["FineUploader"+u](o)):p?new qq[p].FineUploader(o):new qq.FineUploader(o)}function r(o,u){var p=t.data("fineuploader");if(u)p===void 0&&(p={}),p[o]=u,t.data("fineuploader",p);else return p===void 0?null:p[o]}function l(o){return r("uploader",o)}function s(o,u){return r(o,u)}function c(o,u){var p=o.callbacks={};e.each(u._options.callbacks,function(m,b){var g,d;g=/^on(\w+)/.exec(m)[1],g=g.substring(0,1).toLowerCase()+g.substring(1),d=t,p[m]=function(){var _=Array.prototype.slice.call(arguments),y=[],w,x;e.each(_,function(F,C){y.push(q(C))}),w=b.apply(this,_);try{x=d.triggerHandler(g,y)}catch(F){qq.log("Caught error in Fine Uploader jQuery event handler: "+F.message,"error")}return w??x}}),u._options.callbacks=p}function f(o,u){var p,m;if(u===void 0?o.uploaderType!=="basic"?p={element:t[0]}:p={}:p=u,e.each(o,function(b,g){e.inArray(b,n)>=0?s(b,g):g instanceof e?p[b]=g[0]:e.isPlainObject(g)?(p[b]={},f(g,p[b])):e.isArray(g)?(m=[],e.each(g,function(d,_){var y={};_ instanceof e?e.merge(m,_):e.isPlainObject(_)?(f(_,y),m.push(y)):m.push(_)}),p[b]=m):p[b]=g}),u===void 0)return p}function h(o){return e.type(o)==="string"&&!o.match(/^_/)&&l()[o]!==void 0}function S(o){var u=[],p=Array.prototype.slice.call(arguments,1),m;return f(p,u),m=l()[o].apply(l(),u),q(m)}function q(o){var u=o;return o!=null&&typeof o=="object"&&(o.nodeType===1||o.nodeType===9)&&o.cloneNode&&(u=e(o)),u}e.fn.fineUploader=function(o){var u=this,p=arguments,m=[];return this.each(function(b,g){if(t=e(g),l()&&h(o)){if(m.push(S.apply(u,p)),u.length===1)return!1}else typeof o=="object"||!o?i.apply(u,p):e.error("Method "+o+" does not exist on jQuery.fineUploader")}),m.length===1?m[0]:m.length>1?m:this}})(jQuery),function(e){var t="fineUploaderDnd",n;function i(h){h||(h={}),h.dropZoneElements=[n];var S=s(h);return l(S),r(new qq.DragAndDrop(S)),n}function a(h,S){var q=n.data(t);if(S)q===void 0&&(q={}),q[h]=S,n.data(t,q);else return q===void 0?null:q[h]}function r(h){return a("dndInstance",h)}function l(h){var S=h.callbacks={};e.each(new qq.DragAndDrop.callbacks,function(q,o){var u=q,p;p=n,S[q]=function(){var m=Array.prototype.slice.call(arguments),b=p.triggerHandler(u,m);return b}})}function s(h,S){var q,o;if(S===void 0?q={}:q=S,e.each(h,function(u,p){p instanceof e?q[u]=p[0]:e.isPlainObject(p)?(q[u]={},s(p,q[u])):e.isArray(p)?(o=[],e.each(p,function(m,b){b instanceof e?e.merge(o,b):o.push(b)}),q[u]=o):q[u]=p}),S===void 0)return q}function c(h){return e.type(h)==="string"&&h==="dispose"&&r()[h]!==void 0}function f(h){var S=[],q=Array.prototype.slice.call(arguments,1);return s(q,S),r()[h].apply(r(),S)}e.fn.fineUploaderDnd=function(h){var S=this,q=arguments,o=[];return this.each(function(u,p){if(n=e(p),r()&&c(h)){if(o.push(f.apply(S,q)),S.length===1)return!1}else typeof h=="object"||!h?i.apply(S,q):e.error("Method "+h+" does not exist in Fine Uploader's DnD module.")}),o.length===1?o[0]:o.length>1?o:this}}(jQuery);var qq=function(e){return{hide:function(){return e.style.display="none",this},attach:function(t,n){return e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n),function(){qq(e).detach(t,n)}},detach:function(t,n){return e.removeEventListener?e.removeEventListener(t,n,!1):e.attachEvent&&e.detachEvent("on"+t,n),this},contains:function(t){return t?e===t?!0:e.contains?e.contains(t):!!(t.compareDocumentPosition(e)&8):!1},insertBefore:function(t){return t.parentNode.insertBefore(e,t),this},remove:function(){return e.parentNode.removeChild(e),this},css:function(t){if(e.style==null)throw new qq.Error("Can't apply style to node as it is not on the HTMLElement prototype chain!");return t.opacity!=null&&typeof e.style.opacity!="string"&&typeof e.filters<"u"&&(t.filter="alpha(opacity="+Math.round(100*t.opacity)+")"),qq.extend(e.style,t),this},hasClass:function(t,n){var i=new RegExp("(^| )"+t+"( |$)");return i.test(e.className)||!!(n&&i.test(e.parentNode.className))},addClass:function(t){return qq(e).hasClass(t)||(e.className+=" "+t),this},removeClass:function(t){var n=new RegExp("(^| )"+t+"( |$)");return e.className=e.className.replace(n," ").replace(/^\s+|\s+$/g,""),this},getByClass:function(t,n){var i,a=[];return n&&e.querySelector?e.querySelector("."+t):e.querySelectorAll?e.querySelectorAll("."+t):(i=e.getElementsByTagName("*"),qq.each(i,function(r,l){qq(l).hasClass(t)&&a.push(l)}),n?a[0]:a)},getFirstByClass:function(t){return qq(e).getByClass(t,!0)},children:function(){for(var t=[],n=e.firstChild;n;)n.nodeType===1&&t.push(n),n=n.nextSibling;return t},setText:function(t){return e.innerText=t,e.textContent=t,this},clearText:function(){return qq(e).setText("")},hasAttribute:function(t){var n;return e.hasAttribute?e.hasAttribute(t)?/^false$/i.exec(e.getAttribute(t))==null:!1:(n=e[t],n===void 0?!1:/^false$/i.exec(n)==null)}}};(function(){qq.canvasToBlob=function(e,t,n){return qq.dataUriToBlob(e.toDataURL(t,n))},qq.dataUriToBlob=function(e){var t,n,i=function(l,s){var c=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,f=c&&new c;return f?(f.append(l),f.getBlob(s)):new Blob([l],{type:s})},a,r;return e.split(",")[0].indexOf("base64")>=0?n=atob(e.split(",")[1]):n=decodeURI(e.split(",")[1]),r=e.split(",")[0].split(":")[1].split(";")[0],t=new ArrayBuffer(n.length),a=new Uint8Array(t),qq.each(n,function(l,s){a[l]=s.charCodeAt(0)}),i(t,r)},qq.log=function(e,t){window.console&&(!t||t==="info"?window.console.log(e):window.console[t]?window.console[t](e):window.console.log("<"+t+"> "+e))},qq.isObject=function(e){return e&&!e.nodeType&&Object.prototype.toString.call(e)==="[object Object]"},qq.isFunction=function(e){return typeof e=="function"},qq.isArray=function(e){return Object.prototype.toString.call(e)==="[object Array]"||e&&window.ArrayBuffer&&e.buffer&&e.buffer.constructor===ArrayBuffer},qq.isItemList=function(e){return Object.prototype.toString.call(e)==="[object DataTransferItemList]"},qq.isNodeList=function(e){return Object.prototype.toString.call(e)==="[object NodeList]"||e.item&&e.namedItem},qq.isString=function(e){return Object.prototype.toString.call(e)==="[object String]"},qq.trimStr=function(e){return String.prototype.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},qq.format=function(e){var t=Array.prototype.slice.call(arguments,1),n=e,i=n.indexOf("{}");return qq.each(t,function(a,r){var l=n.substring(0,i),s=n.substring(i+2);if(n=l+r+s,i=n.indexOf("{}",i+r.length),i<0)return!1}),n},qq.isFile=function(e){return window.File&&Object.prototype.toString.call(e)==="[object File]"},qq.isFileList=function(e){return window.FileList&&Object.prototype.toString.call(e)==="[object FileList]"},qq.isFileOrInput=function(e){return qq.isFile(e)||qq.isInput(e)},qq.isInput=function(e,t){var n=function(i){var a=i.toLowerCase();return t?a!=="file":a==="file"};return!!(window.HTMLInputElement&&Object.prototype.toString.call(e)==="[object HTMLInputElement]"&&e.type&&n(e.type)||e.tagName&&e.tagName.toLowerCase()==="input"&&e.type&&n(e.type))},qq.isBlob=function(e){if(window.Blob&&Object.prototype.toString.call(e)==="[object Blob]")return!0},qq.isXhrUploadSupported=function(){var e=document.createElement("input");return e.type="file",e.multiple!==void 0&&typeof File<"u"&&typeof FormData<"u"&&typeof qq.createXhrInstance().upload<"u"},qq.createXhrInstance=function(){if(window.XMLHttpRequest)return new XMLHttpRequest;try{return new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch{return qq.log("Neither XHR or ActiveX are supported!","error"),null}},qq.isFolderDropSupported=function(e){return e.items&&e.items.length>0&&e.items[0].webkitGetAsEntry},qq.isFileChunkingSupported=function(){return!qq.androidStock()&&qq.isXhrUploadSupported()&&(File.prototype.slice!==void 0||File.prototype.webkitSlice!==void 0||File.prototype.mozSlice!==void 0)},qq.sliceBlob=function(e,t,n){var i=e.slice||e.mozSlice||e.webkitSlice;return i.call(e,t,n)},qq.arrayBufferToHex=function(e){var t="",n=new Uint8Array(e);return qq.each(n,function(i,a){var r=a.toString(16);r.length<2&&(r="0"+r),t+=r}),t},qq.readBlobToHex=function(e,t,n){var i=qq.sliceBlob(e,t,t+n),a=new FileReader,r=new qq.Promise;return a.onload=function(){r.success(qq.arrayBufferToHex(a.result))},a.onerror=r.failure,a.readAsArrayBuffer(i),r},qq.extend=function(e,t,n){return qq.each(t,function(i,a){n&&qq.isObject(a)?(e[i]===void 0&&(e[i]={}),qq.extend(e[i],a,!0)):e[i]=a}),e},qq.override=function(e,t){var n={},i=t(n);return qq.each(i,function(a,r){e[a]!==void 0&&(n[a]=e[a]),e[a]=r}),e},qq.indexOf=function(e,t,n){if(e.indexOf)return e.indexOf(t,n);n=n||0;var i=e.length;for(n<0&&(n+=i);n<i;n+=1)if(e.hasOwnProperty(n)&&e[n]===t)return n;return-1},qq.getUniqueId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,n=e=="x"?t:t&3|8;return n.toString(16)})},qq.ie=function(){return navigator.userAgent.indexOf("MSIE")!==-1||navigator.userAgent.indexOf("Trident")!==-1},qq.ie7=function(){return navigator.userAgent.indexOf("MSIE 7")!==-1},qq.ie8=function(){return navigator.userAgent.indexOf("MSIE 8")!==-1},qq.ie10=function(){return navigator.userAgent.indexOf("MSIE 10")!==-1},qq.ie11=function(){return qq.ie()&&navigator.userAgent.indexOf("rv:11")!==-1},qq.edge=function(){return navigator.userAgent.indexOf("Edge")>=0},qq.safari=function(){return navigator.vendor!==void 0&&navigator.vendor.indexOf("Apple")!==-1},qq.chrome=function(){return navigator.vendor!==void 0&&navigator.vendor.indexOf("Google")!==-1},qq.opera=function(){return navigator.vendor!==void 0&&navigator.vendor.indexOf("Opera")!==-1},qq.firefox=function(){return!qq.edge()&&!qq.ie11()&&navigator.userAgent.indexOf("Mozilla")!==-1&&navigator.vendor!==void 0&&navigator.vendor===""},qq.windows=function(){return navigator.platform==="Win32"},qq.android=function(){return navigator.userAgent.toLowerCase().indexOf("android")!==-1},qq.androidStock=function(){return qq.android()&&navigator.userAgent.toLowerCase().indexOf("chrome")<0},qq.ios6=function(){return qq.ios()&&navigator.userAgent.indexOf(" OS 6_")!==-1},qq.ios7=function(){return qq.ios()&&navigator.userAgent.indexOf(" OS 7_")!==-1},qq.ios8=function(){return qq.ios()&&navigator.userAgent.indexOf(" OS 8_")!==-1},qq.ios800=function(){return qq.ios()&&navigator.userAgent.indexOf(" OS 8_0 ")!==-1},qq.ios=function(){return navigator.userAgent.indexOf("iPad")!==-1||navigator.userAgent.indexOf("iPod")!==-1||navigator.userAgent.indexOf("iPhone")!==-1},qq.iosChrome=function(){return qq.ios()&&navigator.userAgent.indexOf("CriOS")!==-1},qq.iosSafari=function(){return qq.ios()&&!qq.iosChrome()&&navigator.userAgent.indexOf("Safari")!==-1},qq.iosSafariWebView=function(){return qq.ios()&&!qq.iosChrome()&&!qq.iosSafari()},qq.preventDefault=function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},qq.toElement=function(){var e=document.createElement("div");return function(t){e.innerHTML=t;var n=e.firstChild;return e.removeChild(n),n}}(),qq.each=function(e,t){var n,i;if(e){if(window.Storage&&e.constructor===window.Storage)for(n=0;n<e.length&&(i=t(e.key(n),e.getItem(e.key(n))),i!==!1);n++);else if(qq.isArray(e)||qq.isItemList(e)||qq.isNodeList(e))for(n=0;n<e.length&&(i=t(n,e[n]),i!==!1);n++);else if(qq.isString(e))for(n=0;n<e.length&&(i=t(n,e.charAt(n)),i!==!1);n++);else for(n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&(i=t(n,e[n]),i===!1))break}},qq.bind=function(e,t){if(qq.isFunction(e)){var n=Array.prototype.slice.call(arguments,2);return function(){var i=qq.extend([],n);return arguments.length&&(i=i.concat(Array.prototype.slice.call(arguments))),e.apply(t,i)}}throw new Error("first parameter must be a function!")},qq.obj2url=function(e,t,n){var i=[],a="&",r=function(l,s){var c=t?/\[\]$/.test(t)?t:t+"["+s+"]":s;c!=="undefined"&&s!=="undefined"&&i.push(typeof l=="object"?qq.obj2url(l,c,!0):Object.prototype.toString.call(l)==="[object Function]"?encodeURIComponent(c)+"="+encodeURIComponent(l()):encodeURIComponent(c)+"="+encodeURIComponent(l))};return!n&&t?(a=/\?/.test(t)?/\?$/.test(t)?"":"&":"?",i.push(t),i.push(qq.obj2url(e))):Object.prototype.toString.call(e)==="[object Array]"&&typeof e<"u"?qq.each(e,function(l,s){r(s,l)}):typeof e<"u"&&e!==null&&typeof e=="object"?qq.each(e,function(l,s){r(s,l)}):i.push(encodeURIComponent(t)+"="+encodeURIComponent(e)),t?i.join(a):i.join(a).replace(/^&/,"").replace(/%20/g,"+")},qq.obj2FormData=function(e,t,n){return t||(t=new FormData),qq.each(e,function(i,a){i=n?n+"["+i+"]":i,qq.isObject(a)?qq.obj2FormData(a,t,i):qq.isFunction(a)?t.append(i,a()):t.append(i,a)}),t},qq.obj2Inputs=function(e,t){var n;return t||(t=document.createElement("form")),qq.obj2FormData(e,{append:function(i,a){n=document.createElement("input"),n.setAttribute("name",i),n.setAttribute("value",a),t.appendChild(n)}}),t},qq.parseJson=function(json){return window.JSON&&qq.isFunction(JSON.parse)?JSON.parse(json):eval("("+json+")")},qq.getExtension=function(e){var t=e.lastIndexOf(".")+1;if(t>0)return e.substr(t,e.length-t)},qq.getFilename=function(e){return qq.isInput(e)?e.value.replace(/.*(\/|\\)/,""):qq.isFile(e)&&e.fileName!==null&&e.fileName!==void 0?e.fileName:e.name},qq.DisposeSupport=function(){var e=[];return{dispose:function(){var t;do t=e.shift(),t&&t();while(t)},attach:function(){var t=arguments;this.addDisposer(qq(t[0]).attach.apply(this,Array.prototype.slice.call(arguments,1)))},addDisposer:function(t){e.push(t)}}}})(),function(){module.exports?module.exports=qq:global.qq=qq}(),function(){qq.Error=function(e){this.message="[Fine Uploader "+qq.version+"] "+e},qq.Error.prototype=new Error}(),qq.version="5.16.2",qq.supportedFeatures=function(){var e,t,n,i,a,r,l,s,c,f,h,S,q,o,u;function p(){var x=!0,F;try{F=document.createElement("input"),F.type="file",qq(F).hide(),F.disabled&&(x=!1)}catch{x=!1}return x}function m(){return(qq.chrome()||qq.opera())&&navigator.userAgent.match(/Chrome\/[1][4-9]|Chrome\/[2-9][0-9]/)!==void 0}function b(){if(window.XMLHttpRequest){var x=qq.createXhrInstance();return x.withCredentials!==void 0}return!1}function g(){return window.XDomainRequest!==void 0}function d(){return b()?!0:g()}function _(){return document.createElement("input").webkitdirectory!==void 0}function y(){try{return!!window.localStorage&&qq.isFunction(window.localStorage.setItem)}catch{return!1}}function w(){var x=document.createElement("span");return("draggable"in x||"ondragstart"in x&&"ondrop"in x)&&!qq.android()&&!qq.ios()}return e=p(),i=e&&qq.isXhrUploadSupported(),t=i&&!qq.androidStock(),n=i&&w(),a=n&&function(){var x=document.createElement("input");return x.type="file","webkitdirectory"in(x||document.querySelectorAll("input[type=file]")[0])}(),r=i&&qq.isFileChunkingSupported(),l=i&&r&&y(),s=i&&m(),c=e&&(window.postMessage!==void 0||i),h=b(),f=g(),S=d(),q=_(),o=i&&window.FileReader!==void 0,u=function(){return i?!qq.androidStock()&&!qq.iosChrome():!1}(),{ajaxUploading:i,blobUploading:t,canDetermineSize:i,chunking:r,deleteFileCors:S,deleteFileCorsXdr:f,deleteFileCorsXhr:h,dialogElement:!!window.HTMLDialogElement,fileDrop:n,folderDrop:a,folderSelection:q,imagePreviews:o,imageValidation:o,itemSizeValidation:i,pause:r,progressBar:u,resume:l,scaling:o&&t,tiffPreviews:qq.safari(),unlimitedScaledImageSize:!qq.ios(),uploading:e,uploadCors:c,uploadCustomHeaders:i,uploadNonMultipart:i,uploadViaPaste:s}}(),qq.isGenericPromise=function(e){return!!(e&&e.then&&qq.isFunction(e.then))},qq.Promise=function(){var e,t,n=[],i=[],a=[],r=0;qq.extend(this,{then:function(l,s){return r===0?(l&&n.push(l),s&&i.push(s)):r===-1?s&&s.apply(null,t):l&&l.apply(null,e),this},done:function(l){return r===0?a.push(l):l.apply(null,t===void 0?e:t),this},success:function(){return r=1,e=arguments,n.length&&qq.each(n,function(l,s){s.apply(null,e)}),a.length&&qq.each(a,function(l,s){s.apply(null,e)}),this},failure:function(){return r=-1,t=arguments,i.length&&qq.each(i,function(l,s){s.apply(null,t)}),a.length&&qq.each(a,function(l,s){s.apply(null,t)}),this}})},qq.BlobProxy=function(e,t){qq.extend(this,{referenceBlob:e,create:function(){return t(e)}})},qq.UploadButton=function(e){var t=this,n=new qq.DisposeSupport,i={acceptFiles:null,element:null,focusClass:"qq-upload-button-focus",folders:!1,hoverClass:"qq-upload-button-hover",ios8BrowserCrashWorkaround:!1,multiple:!1,name:"qqfile",onChange:function(s){},title:null},a,r;qq.extend(i,e),r=qq.getUniqueId();function l(){var s=document.createElement("input");return s.setAttribute(qq.UploadButton.BUTTON_ID_ATTR_NAME,r),s.setAttribute("title",i.title),t.setMultiple(i.multiple,s),i.folders&&qq.supportedFeatures.folderSelection&&s.setAttribute("webkitdirectory",""),i.acceptFiles&&s.setAttribute("accept",i.acceptFiles),s.setAttribute("type","file"),s.setAttribute("name",i.name),qq(s).css({position:"absolute",right:0,top:0,fontFamily:"Arial",fontSize:qq.ie()&&!qq.ie8()?"3500px":"118px",margin:0,padding:0,cursor:"pointer",opacity:0}),!qq.ie7()&&qq(s).css({height:"100%"}),i.element.appendChild(s),n.attach(s,"change",function(){i.onChange(s)}),n.attach(s,"mouseover",function(){qq(i.element).addClass(i.hoverClass)}),n.attach(s,"mouseout",function(){qq(i.element).removeClass(i.hoverClass)}),n.attach(s,"focus",function(){qq(i.element).addClass(i.focusClass)}),n.attach(s,"blur",function(){qq(i.element).removeClass(i.focusClass)}),s}qq(i.element).css({position:"relative",overflow:"hidden",direction:"ltr"}),qq.extend(this,{getInput:function(){return a},getButtonId:function(){return r},setMultiple:function(s,c){var f=c||this.getInput();i.ios8BrowserCrashWorkaround&&qq.ios8()&&(qq.iosChrome()||qq.iosSafariWebView())||s?f.setAttribute("multiple",""):f.removeAttribute("multiple")},setAcceptFiles:function(s){s!==i.acceptFiles&&a.setAttribute("accept",s)},reset:function(){a.parentNode&&qq(a).remove(),qq(i.element).removeClass(i.focusClass),a=null,a=l()}}),a=l()},qq.UploadButton.BUTTON_ID_ATTR_NAME="qq-button-id",qq.UploadData=function(e){var t=[],n={},i={},a={},r={};function l(f){if(qq.isArray(f)){var h=[];return qq.each(f,function(S,q){h.push(t[q])}),h}return t[f]}function s(f){if(qq.isArray(f)){var h=[];return qq.each(f,function(S,q){h.push(t[n[q]])}),h}return t[n[f]]}function c(f){var h=[],S=[].concat(f);return qq.each(S,function(q,o){var u=i[o];u!==void 0&&qq.each(u,function(p,m){h.push(t[m])})}),h}qq.extend(this,{addFile:function(f){var h=f.status||qq.status.SUBMITTING,S=t.push({name:f.name,originalName:f.name,uuid:f.uuid,size:f.size==null?-1:f.size,status:h,file:f.file})-1;return f.batchId&&(t[S].batchId=f.batchId,r[f.batchId]===void 0&&(r[f.batchId]=[]),r[f.batchId].push(S)),f.proxyGroupId&&(t[S].proxyGroupId=f.proxyGroupId,a[f.proxyGroupId]===void 0&&(a[f.proxyGroupId]=[]),a[f.proxyGroupId].push(S)),t[S].id=S,n[f.uuid]=S,i[h]===void 0&&(i[h]=[]),i[h].push(S),f.onBeforeStatusChange&&f.onBeforeStatusChange(S),e.onStatusChange(S,null,h),S},retrieve:function(f){if(qq.isObject(f)&&t.length){if(f.id!==void 0)return l(f.id);if(f.uuid!==void 0)return s(f.uuid);if(f.status)return c(f.status)}else return qq.extend([],t,!0)},removeFileRef:function(f){var h=l(f);h&&delete h.file},reset:function(){t=[],n={},i={},r={}},setStatus:function(f,h){var S=t[f].status,q=qq.indexOf(i[S],f);i[S].splice(q,1),t[f].status=h,i[h]===void 0&&(i[h]=[]),i[h].push(f),e.onStatusChange(f,S,h)},uuidChanged:function(f,h){var S=t[f].uuid;t[f].uuid=h,n[h]=f,delete n[S]},updateName:function(f,h){t[f].name=h},updateSize:function(f,h){t[f].size=h},setParentId:function(f,h){t[f].parentId=h},getIdsInProxyGroup:function(f){var h=t[f].proxyGroupId;return h?a[h]:[]},getIdsInBatch:function(f){var h=t[f].batchId;return r[h]}})},qq.status={SUBMITTING:"submitting",SUBMITTED:"submitted",REJECTED:"rejected",QUEUED:"queued",CANCELED:"canceled",PAUSED:"paused",UPLOADING:"uploading",UPLOAD_FINALIZING:"upload finalizing",UPLOAD_RETRYING:"retrying upload",UPLOAD_SUCCESSFUL:"upload successful",UPLOAD_FAILED:"upload failed",DELETE_FAILED:"delete failed",DELETING:"deleting",DELETED:"deleted"},function(){qq.basePublicApi={addBlobs:function(e,t,n){this.addFiles(e,t,n)},addInitialFiles:function(e){var t=this;qq.each(e,function(n,i){t._addCannedFile(i)})},addFiles:function(e,t,n){this._maybeHandleIos8SafariWorkaround();var i=this._storedIds.length===0?qq.getUniqueId():this._currentBatchId,a=qq.bind(function(q){this._handleNewFile({blob:q,name:this._options.blobs.defaultName},i,S)},this),r=qq.bind(function(q){this._handleNewFile(q,i,S)},this),l=qq.bind(function(q){var o=qq.canvasToBlob(q);this._handleNewFile({blob:o,name:this._options.blobs.defaultName+".png"},i,S)},this),s=qq.bind(function(q){var o=q.quality&&q.quality/100,u=qq.canvasToBlob(q.canvas,q.type,o);this._handleNewFile({blob:u,name:q.name},i,S)},this),c=qq.bind(function(q){if(qq.isInput(q)&&qq.supportedFeatures.ajaxUploading){var o=Array.prototype.slice.call(q.files),u=this;qq.each(o,function(p,m){u._handleNewFile(m,i,S)})}else this._handleNewFile(q,i,S)},this),f=function(){qq.isFileList(e)&&(e=Array.prototype.slice.call(e)),e=[].concat(e)},h=this,S=[];this._currentBatchId=i,e&&(f(),qq.each(e,function(q,o){qq.isFileOrInput(o)?c(o):qq.isBlob(o)?a(o):qq.isObject(o)?o.blob&&o.name?r(o):o.canvas&&o.name&&s(o):o.tagName&&o.tagName.toLowerCase()==="canvas"?l(o):h.log(o+" is not a valid file container!  Ignoring!","warn")}),this.log("Received "+S.length+" files."),this._prepareItemsForUpload(S,t,n))},cancel:function(e){var t=this._uploadData.retrieve({id:e});t&&t.status===qq.status.UPLOAD_FINALIZING?this.log(qq.format("Ignoring cancel for file ID {} ({}).  Finalizing upload.",e,this.getName(e)),"error"):this._handler.cancel(e)},cancelAll:function(){var e=[],t=this;qq.extend(e,this._storedIds),qq.each(e,function(n,i){t.cancel(i)}),this._handler.cancelAll()},clearStoredFiles:function(){this._storedIds=[]},continueUpload:function(e){var t=this._uploadData.retrieve({id:e});return!qq.supportedFeatures.pause||!this._options.chunking.enabled?!1:t.status===qq.status.PAUSED?(this.log(qq.format("Paused file ID {} ({}) will be continued.  Not paused.",e,this.getName(e))),this._uploadFile(e),!0):(this.log(qq.format("Ignoring continue for file ID {} ({}).  Not paused.",e,this.getName(e)),"error"),!1)},deleteFile:function(e){return this._onSubmitDelete(e)},doesExist:function(e){return this._handler.isValid(e)},drawThumbnail:function(e,t,n,i,a){var r=new qq.Promise,l,s;return this._imageGenerator?(l=this._thumbnailUrls[e],s={customResizeFunction:a,maxSize:n>0?n:null,scale:n>0},!i&&qq.supportedFeatures.imagePreviews&&(l=this.getFile(e)),l==null?r.failure({container:t,error:"File or URL not found."}):this._imageGenerator.generate(l,t,s).then(function(f){r.success(f)},function(f,h){r.failure({container:f,error:h||"Problem generating thumbnail"})})):r.failure({container:t,error:"Missing image generator module"}),r},getButton:function(e){return this._getButton(this._buttonIdsForFileIds[e])},getEndpoint:function(e){return this._endpointStore.get(e)},getFile:function(e){var t=this._handler.getFile(e),n;return t||(n=this._uploadData.retrieve({id:e}),n&&(t=n.file)),t||null},getInProgress:function(){return this._uploadData.retrieve({status:[qq.status.UPLOADING,qq.status.UPLOAD_RETRYING,qq.status.QUEUED]}).length},getName:function(e){return this._uploadData.retrieve({id:e}).name},getParentId:function(e){var t=this.getUploads({id:e}),n=null;return t&&t.parentId!==void 0&&(n=t.parentId),n},getResumableFilesData:function(){return this._handler.getResumableFilesData()},getSize:function(e){return this._uploadData.retrieve({id:e}).size},getNetUploads:function(){return this._netUploaded},getRemainingAllowedItems:function(){var e=this._currentItemLimit;return e>0?e-this._netUploadedOrQueued:null},getUploads:function(e){return this._uploadData.retrieve(e)},getUuid:function(e){return this._uploadData.retrieve({id:e}).uuid},isResumable:function(e){return this._handler.hasResumeRecord(e)},log:function(e,t){this._options.debug&&(!t||t==="info")?qq.log("[Fine Uploader "+qq.version+"] "+e):t&&t!=="info"&&qq.log("[Fine Uploader "+qq.version+"] "+e,t)},pauseUpload:function(e){var t=this._uploadData.retrieve({id:e});if(!qq.supportedFeatures.pause||!this._options.chunking.enabled)return!1;if(qq.indexOf([qq.status.UPLOADING,qq.status.UPLOAD_RETRYING],t.status)>=0){if(this._handler.pause(e))return this._uploadData.setStatus(e,qq.status.PAUSED),!0;this.log(qq.format("Unable to pause file ID {} ({}).",e,this.getName(e)),"error")}else this.log(qq.format("Ignoring pause for file ID {} ({}).  Not in progress.",e,this.getName(e)),"error");return!1},removeFileRef:function(e){this._handler.expunge(e),this._uploadData.removeFileRef(e)},reset:function(){this.log("Resetting uploader..."),this._handler.reset(),this._storedIds=[],this._autoRetries=[],this._retryTimeouts=[],this._preventRetries=[],this._thumbnailUrls=[],qq.each(this._buttons,function(e,t){t.reset()}),this._paramsStore.reset(),this._endpointStore.reset(),this._netUploadedOrQueued=0,this._netUploaded=0,this._uploadData.reset(),this._buttonIdsForFileIds=[],this._pasteHandler&&this._pasteHandler.reset(),this._options.session.refreshOnReset&&this._refreshSessionData(),this._succeededSinceLastAllComplete=[],this._failedSinceLastAllComplete=[],this._totalProgress&&this._totalProgress.reset(),this._customResumeDataStore.reset()},retry:function(e){return this._manualRetry(e)},scaleImage:function(e,t){var n=this;return qq.Scaler.prototype.scaleImage(e,t,{log:qq.bind(n.log,n),getFile:qq.bind(n.getFile,n),uploadData:n._uploadData})},setCustomHeaders:function(e,t){this._customHeadersStore.set(e,t)},setCustomResumeData:function(e,t){this._customResumeDataStore.set(t,e)},setDeleteFileCustomHeaders:function(e,t){this._deleteFileCustomHeadersStore.set(e,t)},setDeleteFileEndpoint:function(e,t){this._deleteFileEndpointStore.set(e,t)},setDeleteFileParams:function(e,t){this._deleteFileParamsStore.set(e,t)},setEndpoint:function(e,t){this._endpointStore.set(e,t)},setForm:function(e){this._updateFormSupportAndParams(e)},setItemLimit:function(e){this._currentItemLimit=e},setName:function(e,t){this._uploadData.updateName(e,t)},setParams:function(e,t){this._paramsStore.set(e,t)},setUuid:function(e,t){return this._uploadData.uuidChanged(e,t)},setStatus:function(e,t){var n=this.getUploads({id:e});if(!n)throw new qq.Error(e+" is not a valid file ID.");switch(t){case qq.status.DELETED:this._onDeleteComplete(e,null,!1);break;case qq.status.DELETE_FAILED:this._onDeleteComplete(e,null,!0);break;default:var i="Method setStatus called on '"+name+"' not implemented yet for "+t;throw this.log(i),new qq.Error(i)}},uploadStoredFiles:function(){this._storedIds.length===0?this._itemError("noFilesError"):this._uploadStoredFiles()}},qq.basePrivateApi={_addCannedFile:function(e){var t=this;return this._uploadData.addFile({uuid:e.uuid,name:e.name,size:e.size,status:qq.status.UPLOAD_SUCCESSFUL,onBeforeStatusChange:function(n){e.deleteFileEndpoint&&t.setDeleteFileEndpoint(e.deleteFileEndpoint,n),e.deleteFileParams&&t.setDeleteFileParams(e.deleteFileParams,n),e.thumbnailUrl&&(t._thumbnailUrls[n]=e.thumbnailUrl),t._netUploaded++,t._netUploadedOrQueued++}})},_annotateWithButtonId:function(e,t){qq.isFile(e)&&(e.qqButtonId=this._getButtonId(t))},_batchError:function(e){this._options.callbacks.onError(null,null,e,void 0)},_createDeleteHandler:function(){var e=this;return new qq.DeleteFileAjaxRequester({method:this._options.deleteFile.method.toUpperCase(),maxConnections:this._options.maxConnections,uuidParamName:this._options.request.uuidName,customHeaders:this._deleteFileCustomHeadersStore,paramsStore:this._deleteFileParamsStore,endpointStore:this._deleteFileEndpointStore,cors:this._options.cors,log:qq.bind(e.log,e),onDelete:function(t){e._onDelete(t),e._options.callbacks.onDelete(t)},onDeleteComplete:function(t,n,i){e._onDeleteComplete(t,n,i),e._options.callbacks.onDeleteComplete(t,n,i)}})},_createPasteHandler:function(){var e=this;return new qq.PasteSupport({targetElement:this._options.paste.targetElement,callbacks:{log:qq.bind(e.log,e),pasteReceived:function(t){e._handleCheckedCallback({name:"onPasteReceived",callback:qq.bind(e._options.callbacks.onPasteReceived,e,t),onSuccess:qq.bind(e._handlePasteSuccess,e,t),identifier:"pasted image"})}}})},_createStore:function(e,t){var n={},i=e,a={},r=t,l=function(f){return qq.isObject(f)?qq.extend({},f):f},s=function(){return qq.isFunction(r)?r():r},c=function(f,h){r&&qq.isObject(h)&&qq.extend(h,s()),a[f]&&qq.extend(h,a[f])};return{set:function(f,h){h==null?(n={},i=l(f)):n[h]=l(f)},get:function(f){var h;return f!=null&&n[f]?h=n[f]:h=l(i),c(f,h),l(h)},addReadOnly:function(f,h){qq.isObject(n)&&(f===null?qq.isFunction(h)?r=h:(r=r||{},qq.extend(r,h)):(a[f]=a[f]||{},qq.extend(a[f],h)))},remove:function(f){return delete n[f]},reset:function(){n={},a={},i=e}}},_createUploadDataTracker:function(){var e=this;return new qq.UploadData({getName:function(t){return e.getName(t)},getUuid:function(t){return e.getUuid(t)},getSize:function(t){return e.getSize(t)},onStatusChange:function(t,n,i){e._onUploadStatusChange(t,n,i),e._options.callbacks.onStatusChange(t,n,i),e._maybeAllComplete(t,i),e._totalProgress&&setTimeout(function(){e._totalProgress.onStatusChange(t,n,i)},0)}})},_createUploadButton:function(e){var t=this,n=e.accept||this._options.validation.acceptFiles,i=e.allowedExtensions||this._options.validation.allowedExtensions,a;function r(){return qq.supportedFeatures.ajaxUploading?t._options.workarounds.iosEmptyVideos&&qq.ios()&&!qq.ios6()&&t._isAllowedExtension(i,".mov")?!1:e.multiple===void 0?t._options.multiple:e.multiple:!1}return a=new qq.UploadButton({acceptFiles:n,element:e.element,focusClass:this._options.classes.buttonFocus,folders:e.folders,hoverClass:this._options.classes.buttonHover,ios8BrowserCrashWorkaround:this._options.workarounds.ios8BrowserCrash,multiple:r(),name:this._options.request.inputName,onChange:function(l){t._onInputChange(l)},title:e.title==null?this._options.text.fileInputTitle:e.title}),this._disposeSupport.addDisposer(function(){a.dispose()}),t._buttons.push(a),a},_createUploadHandler:function(e,t){var n=this,i={},a={debug:this._options.debug,maxConnections:this._options.maxConnections,cors:this._options.cors,paramsStore:this._paramsStore,endpointStore:this._endpointStore,chunking:this._options.chunking,resume:this._options.resume,blobs:this._options.blobs,log:qq.bind(n.log,n),preventRetryParam:this._options.retry.preventRetryResponseProperty,onProgress:function(r,l,s,c){s<0||c<0||(i[r]?(i[r].loaded!==s||i[r].total!==c)&&(n._onProgress(r,l,s,c),n._options.callbacks.onProgress(r,l,s,c)):(n._onProgress(r,l,s,c),n._options.callbacks.onProgress(r,l,s,c)),i[r]={loaded:s,total:c})},onComplete:function(r,l,s,c){delete i[r];var f=n.getUploads({id:r}).status,h;f===qq.status.UPLOAD_SUCCESSFUL||f===qq.status.UPLOAD_FAILED||(h=n._onComplete(r,l,s,c),h instanceof qq.Promise?h.done(function(){n._options.callbacks.onComplete(r,l,s,c)}):n._options.callbacks.onComplete(r,l,s,c))},onCancel:function(r,l,s){var c=new qq.Promise;return n._handleCheckedCallback({name:"onCancel",callback:qq.bind(n._options.callbacks.onCancel,n,r,l),onFailure:c.failure,onSuccess:function(){s.then(function(){n._onCancel(r,l)}),c.success()},identifier:r}),c},onUploadPrep:qq.bind(this._onUploadPrep,this),onUpload:function(r,l){n._onUpload(r,l);var s=n._options.callbacks.onUpload(r,l);return qq.isGenericPromise(s)?(n.log(qq.format("onUpload for {} returned a Promise - waiting for resolution.",r)),s):new qq.Promise().success()},onUploadChunk:function(r,l,s){n._onUploadChunk(r,s);var c=n._options.callbacks.onUploadChunk(r,l,s);return qq.isGenericPromise(c)?(n.log(qq.format("onUploadChunk for {}.{} returned a Promise - waiting for resolution.",r,s.partIndex)),c):new qq.Promise().success()},onUploadChunkSuccess:function(r,l,s,c){n._onUploadChunkSuccess(r,l),n._options.callbacks.onUploadChunkSuccess.apply(n,arguments)},onResume:function(r,l,s,c){return n._options.callbacks.onResume(r,l,s,c)},onAutoRetry:function(r,l,s,c){return n._onAutoRetry.apply(n,arguments)},onUuidChanged:function(r,l){n.log("Server requested UUID change from '"+n.getUuid(r)+"' to '"+l+"'"),n.setUuid(r,l)},getName:qq.bind(n.getName,n),getUuid:qq.bind(n.getUuid,n),getSize:qq.bind(n.getSize,n),setSize:qq.bind(n._setSize,n),getDataByUuid:function(r){return n.getUploads({uuid:r})},isQueued:function(r){var l=n.getUploads({id:r}).status;return l===qq.status.QUEUED||l===qq.status.SUBMITTED||l===qq.status.UPLOAD_RETRYING||l===qq.status.PAUSED},getIdsInProxyGroup:n._uploadData.getIdsInProxyGroup,getIdsInBatch:n._uploadData.getIdsInBatch,isInProgress:function(r){return n.getUploads({id:r}).status===qq.status.UPLOADING},getCustomResumeData:qq.bind(n._getCustomResumeData,n),setStatus:function(r,l){n._uploadData.setStatus(r,l)}};return qq.each(this._options.request,function(r,l){a[r]=l}),a.customHeaders=this._customHeadersStore,e&&qq.each(e,function(r,l){a[r]=l}),new qq.UploadHandlerController(a,t)},_fileOrBlobRejected:function(e){this._netUploadedOrQueued--,this._uploadData.setStatus(e,qq.status.REJECTED)},_formatSize:function(e){if(e===0)return e+this._options.text.sizeSymbols[0];var t=-1;do e=e/1e3,t++;while(e>999);return Math.max(e,.1).toFixed(1)+this._options.text.sizeSymbols[t]},_generateExtraButtonSpecs:function(){var e=this;this._extraButtonSpecs={},qq.each(this._options.extraButtons,function(t,n){var i=n.multiple,a=qq.extend({},e._options.validation,!0),r=qq.extend({},n);i===void 0&&(i=e._options.multiple),r.validation&&qq.extend(a,n.validation,!0),qq.extend(r,{multiple:i,validation:a},!0),e._initExtraButton(r)})},_getButton:function(e){var t=this._extraButtonSpecs[e];if(t)return t.element;if(e===this._defaultButtonId)return this._options.button},_getButtonId:function(e){var t,n,i=e;if(i instanceof qq.BlobProxy&&(i=i.referenceBlob),i&&!qq.isBlob(i)){if(qq.isFile(i))return i.qqButtonId;if(i.tagName.toLowerCase()==="input"&&i.type.toLowerCase()==="file")return i.getAttribute(qq.UploadButton.BUTTON_ID_ATTR_NAME);if(t=i.getElementsByTagName("input"),qq.each(t,function(a,r){if(r.getAttribute("type")==="file")return n=r,!1}),n)return n.getAttribute(qq.UploadButton.BUTTON_ID_ATTR_NAME)}},_getCustomResumeData:function(e){return this._customResumeDataStore.get(e)},_getNotFinished:function(){return this._uploadData.retrieve({status:[qq.status.UPLOADING,qq.status.UPLOAD_RETRYING,qq.status.QUEUED,qq.status.SUBMITTING,qq.status.SUBMITTED,qq.status.PAUSED]}).length},_getValidationBase:function(e){var t=this._extraButtonSpecs[e];return t?t.validation:this._options.validation},_getValidationDescriptor:function(e){return e.file instanceof qq.BlobProxy?{name:qq.getFilename(e.file.referenceBlob),size:e.file.referenceBlob.size}:{name:this.getUploads({id:e.id}).name,size:this.getUploads({id:e.id}).size}},_getValidationDescriptors:function(e){var t=this,n=[];return qq.each(e,function(i,a){n.push(t._getValidationDescriptor(a))}),n},_handleCameraAccess:function(){if(this._options.camera.ios&&qq.ios()){var e="image/*;capture=camera",t=this._options.camera.button,n=t?this._getButtonId(t):this._defaultButtonId,i=this._options;n&&n!==this._defaultButtonId&&(i=this._extraButtonSpecs[n]),i.multiple=!1,i.validation.acceptFiles===null?i.validation.acceptFiles=e:i.validation.acceptFiles+=","+e,qq.each(this._buttons,function(a,r){if(r.getButtonId()===n)return r.setMultiple(i.multiple),r.setAcceptFiles(i.acceptFiles),!1})}},_handleCheckedCallback:function(e){var t=this,n=e.callback();return qq.isGenericPromise(n)?(this.log(e.name+" - waiting for "+e.name+" promise to be fulfilled for "+e.identifier),n.then(function(i){t.log(e.name+" promise success for "+e.identifier),e.onSuccess(i)},function(){e.onFailure?(t.log(e.name+" promise failure for "+e.identifier),e.onFailure()):t.log(e.name+" promise failure for "+e.identifier)})):(n!==!1?e.onSuccess(n):e.onFailure?(this.log(e.name+" - return value was 'false' for "+e.identifier+".  Invoking failure callback."),e.onFailure()):this.log(e.name+" - return value was 'false' for "+e.identifier+".  Will not proceed."),n)},_handleNewFile:function(e,t,n){var i=this,a=qq.getUniqueId(),r=-1,l=qq.getFilename(e),s=e.blob||e,c=this._customNewFileHandler?this._customNewFileHandler:qq.bind(i._handleNewFileGeneric,i);!qq.isInput(s)&&s.size>=0&&(r=s.size),c(s,l,a,r,n,t,this._options.request.uuidName,{uploadData:i._uploadData,paramsStore:i._paramsStore,addFileToHandler:function(f,h){i._handler.add(f,h),i._netUploadedOrQueued++,i._trackButton(f)}})},_handleNewFileGeneric:function(e,t,n,i,a,r){var l=this._uploadData.addFile({uuid:n,name:t,size:i,batchId:r,file:e});this._handler.add(l,e),this._trackButton(l),this._netUploadedOrQueued++,a.push({id:l,file:e})},_handlePasteSuccess:function(e,t){var n=e.type.split("/")[1],i=t;i==null&&(i=this._options.paste.defaultName),i+="."+n,this.addFiles({name:i,blob:e})},_handleDeleteSuccess:function(e){if(this.getUploads({id:e}).status!==qq.status.DELETED){var t=this.getName(e);this._netUploadedOrQueued--,this._netUploaded--,this._handler.expunge(e),this._uploadData.setStatus(e,qq.status.DELETED),this.log("Delete request for '"+t+"' has succeeded.")}},_handleDeleteFailed:function(e,t){var n=this.getName(e);this._uploadData.setStatus(e,qq.status.DELETE_FAILED),this.log("Delete request for '"+n+"' has failed.","error"),!t||t.withCredentials===void 0?this._options.callbacks.onError(e,n,"Delete request failed",t):this._options.callbacks.onError(e,n,"Delete request failed with response code "+t.status,t)},_initExtraButton:function(e){var t=this._createUploadButton({accept:e.validation.acceptFiles,allowedExtensions:e.validation.allowedExtensions,element:e.element,folders:e.folders,multiple:e.multiple,title:e.fileInputTitle});this._extraButtonSpecs[t.getButtonId()]=e},_initFormSupportAndParams:function(){this._formSupport=qq.FormSupport&&new qq.FormSupport(this._options.form,qq.bind(this.uploadStoredFiles,this),qq.bind(this.log,this)),this._formSupport&&this._formSupport.attachedToForm?(this._paramsStore=this._createStore(this._options.request.params,this._formSupport.getFormInputsAsObject),this._options.autoUpload=this._formSupport.newAutoUpload,this._formSupport.newEndpoint&&(this._options.request.endpoint=this._formSupport.newEndpoint)):this._paramsStore=this._createStore(this._options.request.params)},_isDeletePossible:function(){return!qq.DeleteFileAjaxRequester||!this._options.deleteFile.enabled?!1:this._options.cors.expected?!!(qq.supportedFeatures.deleteFileCorsXhr||qq.supportedFeatures.deleteFileCorsXdr&&this._options.cors.allowXdr):!0},_isAllowedExtension:function(e,t){var n=!1;return e.length?(qq.each(e,function(i,a){if(qq.isString(a)){var r=new RegExp("\\."+a+"$","i");if(t.match(r)!=null)return n=!0,!1}}),n):!0},_itemError:function(e,t,n){var i=this._options.messages[e],a=[],r=[].concat(t),l=r[0],s=this._getButtonId(n),c=this._getValidationBase(s),f,h;function S(q,o){i=i.replace(q,o)}return qq.each(c.allowedExtensions,function(q,o){qq.isString(o)&&a.push(o)}),f=a.join(", ").toLowerCase(),S("{file}",this._options.formatFileName(l)),S("{extensions}",f),S("{sizeLimit}",this._formatSize(c.sizeLimit)),S("{minSizeLimit}",this._formatSize(c.minSizeLimit)),h=i.match(/(\{\w+\})/g),h!==null&&qq.each(h,function(q,o){S(o,r[q])}),this._options.callbacks.onError(null,l,i,void 0),i},_manualRetry:function(e,t){if(this._onBeforeManualRetry(e))return this._netUploadedOrQueued++,this._uploadData.setStatus(e,qq.status.UPLOAD_RETRYING),t?t(e):this._handler.retry(e),!0},_maybeAllComplete:function(e,t){var n=this,i=this._getNotFinished();t===qq.status.UPLOAD_SUCCESSFUL?this._succeededSinceLastAllComplete.push(e):t===qq.status.UPLOAD_FAILED&&this._failedSinceLastAllComplete.push(e),i===0&&(this._succeededSinceLastAllComplete.length||this._failedSinceLastAllComplete.length)&&setTimeout(function(){n._onAllComplete(n._succeededSinceLastAllComplete,n._failedSinceLastAllComplete)},0)},_maybeHandleIos8SafariWorkaround:function(){var e=this;if(this._options.workarounds.ios8SafariUploads&&qq.ios800()&&qq.iosSafari())throw setTimeout(function(){window.alert(e._options.messages.unsupportedBrowserIos8Safari)},0),new qq.Error(this._options.messages.unsupportedBrowserIos8Safari)},_maybeParseAndSendUploadError:function(e,t,n,i){if(!n.success)if(i&&i.status!==200&&!n.error)this._options.callbacks.onError(e,t,"XHR returned response code "+i.status,i);else{var a=n.error?n.error:this._options.text.defaultResponseError;this._options.callbacks.onError(e,t,a,i)}},_maybeProcessNextItemAfterOnValidateCallback:function(e,t,n,i,a){var r=this;if(t.length>n){if(e||!this._options.validation.stopOnFirstInvalidFile)setTimeout(function(){var l=r._getValidationDescriptor(t[n]),s=r._getButtonId(t[n].file),c=r._getButton(s);r._handleCheckedCallback({name:"onValidate",callback:qq.bind(r._options.callbacks.onValidate,r,l,c),onSuccess:qq.bind(r._onValidateCallbackSuccess,r,t,n,i,a),onFailure:qq.bind(r._onValidateCallbackFailure,r,t,n,i,a),identifier:"Item '"+l.name+"', size: "+l.size})},0);else if(!e)for(;n<t.length;n++)r._fileOrBlobRejected(t[n].id)}},_onAllComplete:function(e,t){this._totalProgress&&this._totalProgress.onAllComplete(e,t,this._preventRetries),this._options.callbacks.onAllComplete(qq.extend([],e),qq.extend([],t)),this._succeededSinceLastAllComplete=[],this._failedSinceLastAllComplete=[]},_onAutoRetry:function(e,t,n,i,a){var r=this;if(r._preventRetries[e]=n[r._options.retry.preventRetryResponseProperty],r._shouldAutoRetry(e)){var l=r._options.retry.autoAttemptDelay*1e3;return r._maybeParseAndSendUploadError.apply(r,arguments),r._options.callbacks.onAutoRetry(e,t,r._autoRetries[e]),r._onBeforeAutoRetry(e,t),r._uploadData.setStatus(e,qq.status.UPLOAD_RETRYING),r._retryTimeouts[e]=setTimeout(function(){r.log("Starting retry for "+t+"..."),a?a(e):r._handler.retry(e)},l),!0}},_onBeforeAutoRetry:function(e,t){this.log("Waiting "+this._options.retry.autoAttemptDelay+" seconds before retrying "+t+"...")},_onBeforeManualRetry:function(e){var t=this._currentItemLimit,n;return this._preventRetries[e]?(this.log("Retries are forbidden for id "+e,"warn"),!1):this._handler.isValid(e)?(n=this.getName(e),this._options.callbacks.onManualRetry(e,n)===!1?!1:t>0&&this._netUploadedOrQueued+1>t?(this._itemError("retryFailTooManyItems"),!1):(this.log("Retrying upload for '"+n+"' (id: "+e+")..."),!0)):(this.log("'"+e+"' is not a valid file ID","error"),!1)},_onCancel:function(e,t){this._netUploadedOrQueued--,clearTimeout(this._retryTimeouts[e]);var n=qq.indexOf(this._storedIds,e);!this._options.autoUpload&&n>=0&&this._storedIds.splice(n,1),this._uploadData.setStatus(e,qq.status.CANCELED)},_onComplete:function(e,t,n,i){return n.success?(n.thumbnailUrl&&(this._thumbnailUrls[e]=n.thumbnailUrl),this._netUploaded++,this._uploadData.setStatus(e,qq.status.UPLOAD_SUCCESSFUL)):(this._netUploadedOrQueued--,this._uploadData.setStatus(e,qq.status.UPLOAD_FAILED),n[this._options.retry.preventRetryResponseProperty]===!0&&(this._preventRetries[e]=!0)),this._maybeParseAndSendUploadError(e,t,n,i),!!n.success},_onDelete:function(e){this._uploadData.setStatus(e,qq.status.DELETING)},_onDeleteComplete:function(e,t,n){this.getName(e),n?this._handleDeleteFailed(e,t):this._handleDeleteSuccess(e)},_onInputChange:function(e){var t;if(qq.supportedFeatures.ajaxUploading){for(t=0;t<e.files.length;t++)this._annotateWithButtonId(e.files[t],e);this.addFiles(e.files)}else e.value.length>0&&this.addFiles(e);qq.each(this._buttons,function(n,i){i.reset()})},_onProgress:function(e,t,n,i){this._totalProgress&&this._totalProgress.onIndividualProgress(e,n,i)},_onSubmit:function(e,t){},_onSubmitCallbackSuccess:function(e,t){this._onSubmit.apply(this,arguments),this._uploadData.setStatus(e,qq.status.SUBMITTED),this._onSubmitted.apply(this,arguments),this._options.autoUpload?(this._options.callbacks.onSubmitted.apply(this,arguments),this._uploadFile(e)):(this._storeForLater(e),this._options.callbacks.onSubmitted.apply(this,arguments))},_onSubmitDelete:function(e,t,n){var i=this.getUuid(e),a;return t&&(a=qq.bind(t,this,e,i,n)),this._isDeletePossible()?(this._handleCheckedCallback({name:"onSubmitDelete",callback:qq.bind(this._options.callbacks.onSubmitDelete,this,e),onSuccess:a||qq.bind(this._deleteHandler.sendDelete,this,e,i,n),identifier:e}),!0):(this.log("Delete request ignored for ID "+e+", delete feature is disabled or request not possible due to CORS on a user agent that does not support pre-flighting.","warn"),!1)},_onSubmitted:function(e){},_onTotalProgress:function(e,t){this._options.callbacks.onTotalProgress(e,t)},_onUploadPrep:function(e){},_onUpload:function(e,t){this._uploadData.setStatus(e,qq.status.UPLOADING)},_onUploadChunk:function(e,t){},_onUploadChunkSuccess:function(e,t){!this._preventRetries[e]&&this._options.retry.enableAuto&&(this._autoRetries[e]=0)},_onUploadStatusChange:function(e,t,n){n===qq.status.PAUSED&&clearTimeout(this._retryTimeouts[e])},_onValidateBatchCallbackFailure:function(e){var t=this;qq.each(e,function(n,i){t._fileOrBlobRejected(i.id)})},_onValidateBatchCallbackSuccess:function(e,t,n,i,a){var r,l=this._currentItemLimit,s=this._netUploadedOrQueued;l===0||s<=l?t.length>0?this._handleCheckedCallback({name:"onValidate",callback:qq.bind(this._options.callbacks.onValidate,this,e[0],a),onSuccess:qq.bind(this._onValidateCallbackSuccess,this,t,0,n,i),onFailure:qq.bind(this._onValidateCallbackFailure,this,t,0,n,i),identifier:"Item '"+t[0].file.name+"', size: "+t[0].file.size}):this._itemError("noFilesError"):(this._onValidateBatchCallbackFailure(t),r=this._options.messages.tooManyItemsError.replace(/\{netItems\}/g,s).replace(/\{itemLimit\}/g,l),this._batchError(r))},_onValidateCallbackFailure:function(e,t,n,i){var a=t+1;this._fileOrBlobRejected(e[t].id,e[t].file.name),this._maybeProcessNextItemAfterOnValidateCallback(!1,e,a,n,i)},_onValidateCallbackSuccess:function(e,t,n,i){var a=this,r=t+1,l=this._getValidationDescriptor(e[t]);this._validateFileOrBlobData(e[t],l).then(function(){a._upload(e[t].id,n,i),a._maybeProcessNextItemAfterOnValidateCallback(!0,e,r,n,i)},function(){a._maybeProcessNextItemAfterOnValidateCallback(!1,e,r,n,i)})},_prepareItemsForUpload:function(e,t,n){if(e.length===0){this._itemError("noFilesError");return}var i=this._getValidationDescriptors(e),a=this._getButtonId(e[0].file),r=this._getButton(a);this._handleCheckedCallback({name:"onValidateBatch",callback:qq.bind(this._options.callbacks.onValidateBatch,this,i,r),onSuccess:qq.bind(this._onValidateBatchCallbackSuccess,this,i,e,t,n,r),onFailure:qq.bind(this._onValidateBatchCallbackFailure,this,e),identifier:"batch validation"})},_preventLeaveInProgress:function(){var e=this;this._disposeSupport.attach(window,"beforeunload",function(t){if(e.getInProgress())return t=t||window.event,t.returnValue=e._options.messages.onLeave,e._options.messages.onLeave})},_refreshSessionData:function(){var e=this,t=this._options.session;qq.Session&&this._options.session.endpoint!=null&&(this._session||(qq.extend(t,{cors:this._options.cors}),t.log=qq.bind(this.log,this),t.addFileRecord=qq.bind(this._addCannedFile,this),this._session=new qq.Session(t)),setTimeout(function(){e._session.refresh().then(function(n,i){e._sessionRequestComplete(),e._options.callbacks.onSessionRequestComplete(n,!0,i)},function(n,i){e._options.callbacks.onSessionRequestComplete(n,!1,i)})},0))},_sessionRequestComplete:function(){},_setSize:function(e,t){this._uploadData.updateSize(e,t),this._totalProgress&&this._totalProgress.onNewSize(e)},_shouldAutoRetry:function(e){var t=this._uploadData.retrieve({id:e});return!this._preventRetries[e]&&this._options.retry.enableAuto&&t.status!==qq.status.PAUSED&&(this._autoRetries[e]===void 0&&(this._autoRetries[e]=0),this._autoRetries[e]<this._options.retry.maxAutoAttempts)?(this._autoRetries[e]+=1,!0):!1},_storeForLater:function(e){this._storedIds.push(e)},_trackButton:function(e){var t;qq.supportedFeatures.ajaxUploading?t=this._handler.getFile(e).qqButtonId:t=this._getButtonId(this._handler.getInput(e)),t&&(this._buttonIdsForFileIds[e]=t)},_updateFormSupportAndParams:function(e){this._options.form.element=e,this._formSupport=qq.FormSupport&&new qq.FormSupport(this._options.form,qq.bind(this.uploadStoredFiles,this),qq.bind(this.log,this)),this._formSupport&&this._formSupport.attachedToForm&&(this._paramsStore.addReadOnly(null,this._formSupport.getFormInputsAsObject),this._options.autoUpload=this._formSupport.newAutoUpload,this._formSupport.newEndpoint&&this.setEndpoint(this._formSupport.newEndpoint))},_upload:function(e,t,n){var i=this.getName(e);t&&this.setParams(t,e),n&&this.setEndpoint(n,e),this._handleCheckedCallback({name:"onSubmit",callback:qq.bind(this._options.callbacks.onSubmit,this,e,i),onSuccess:qq.bind(this._onSubmitCallbackSuccess,this,e,i),onFailure:qq.bind(this._fileOrBlobRejected,this,e,i),identifier:e})},_uploadFile:function(e){this._handler.upload(e)||this._uploadData.setStatus(e,qq.status.QUEUED)},_uploadStoredFiles:function(){for(var e,t,n=this;this._storedIds.length;)e=this._storedIds.shift(),this._uploadFile(e);t=this.getUploads({status:qq.status.SUBMITTING}).length,t&&(qq.log("Still waiting for "+t+" files to clear submit queue. Will re-parse stored IDs array shortly."),setTimeout(function(){n._uploadStoredFiles()},1e3))},_validateFileOrBlobData:function(e,t){var n=this,i=function(){return e.file instanceof qq.BlobProxy?e.file.referenceBlob:e.file}(),a=t.name,r=t.size,l=this._getButtonId(e.file),s=this._getValidationBase(l),c=new qq.Promise;return c.then(function(){},function(){n._fileOrBlobRejected(e.id,a)}),qq.isFileOrInput(i)&&!this._isAllowedExtension(s.allowedExtensions,a)?(this._itemError("typeError",a,i),c.failure()):!this._options.validation.allowEmpty&&r===0?(this._itemError("emptyError",a,i),c.failure()):r>0&&s.sizeLimit&&r>s.sizeLimit?(this._itemError("sizeError",a,i),c.failure()):r>0&&r<s.minSizeLimit?(this._itemError("minSizeError",a,i),c.failure()):(qq.ImageValidation&&qq.supportedFeatures.imagePreviews&&qq.isFile(i)?new qq.ImageValidation(i,qq.bind(n.log,n)).validate(s.image).then(c.success,function(f){n._itemError(f+"ImageError",a,i),c.failure()}):c.success(),c)},_wrapCallbacks:function(){var e,t,n;e=this,t=function(i,a,r){var l;try{return a.apply(e,r)}catch(s){l=s.message||s.toString(),e.log("Caught exception in '"+i+"' callback - "+l,"error")}};for(n in this._options.callbacks)(function(){var i,a;i=n,a=e._options.callbacks[i],e._options.callbacks[i]=function(){return t(i,a,arguments)}})()}}}(),function(){qq.FineUploaderBasic=function(e){var t=this;this._options={debug:!1,button:null,multiple:!0,maxConnections:3,disableCancelForFormUploads:!1,autoUpload:!0,warnBeforeUnload:!0,request:{customHeaders:{},endpoint:"/server/upload",filenameParam:"qqfilename",forceMultipart:!0,inputName:"qqfile",method:"POST",omitDefaultParams:!1,params:{},paramsInBody:!0,requireSuccessJson:!0,totalFileSizeName:"qqtotalfilesize",uuidName:"qquuid"},validation:{allowedExtensions:[],sizeLimit:0,minSizeLimit:0,itemLimit:0,stopOnFirstInvalidFile:!0,acceptFiles:null,image:{maxHeight:0,maxWidth:0,minHeight:0,minWidth:0},allowEmpty:!1},callbacks:{onSubmit:function(n,i){},onSubmitted:function(n,i){},onComplete:function(n,i,a,r){},onAllComplete:function(n,i){},onCancel:function(n,i){},onUpload:function(n,i){},onUploadChunk:function(n,i,a){},onUploadChunkSuccess:function(n,i,a,r){},onResume:function(n,i,a,r){},onProgress:function(n,i,a,r){},onTotalProgress:function(n,i){},onError:function(n,i,a,r){},onAutoRetry:function(n,i,a){},onManualRetry:function(n,i){},onValidateBatch:function(n){},onValidate:function(n){},onSubmitDelete:function(n){},onDelete:function(n){},onDeleteComplete:function(n,i,a){},onPasteReceived:function(n){},onStatusChange:function(n,i,a){},onSessionRequestComplete:function(n,i,a){}},messages:{typeError:"{file} has an invalid extension. Valid extension(s): {extensions}.",sizeError:"{file} is too large, maximum file size is {sizeLimit}.",minSizeError:"{file} is too small, minimum file size is {minSizeLimit}.",emptyError:"{file} is empty, please select files again without it.",noFilesError:"No files to upload.",tooManyItemsError:"Too many items ({netItems}) would be uploaded.  Item limit is {itemLimit}.",maxHeightImageError:"Image is too tall.",maxWidthImageError:"Image is too wide.",minHeightImageError:"Image is not tall enough.",minWidthImageError:"Image is not wide enough.",retryFailTooManyItems:"Retry failed - you have reached your file limit.",onLeave:"The files are being uploaded, if you leave now the upload will be canceled.",unsupportedBrowserIos8Safari:"Unrecoverable error - this browser does not permit file uploading of any kind due to serious bugs in iOS8 Safari.  Please use iOS8 Chrome until Apple fixes these issues."},retry:{enableAuto:!1,maxAutoAttempts:3,autoAttemptDelay:5,preventRetryResponseProperty:"preventRetry"},classes:{buttonHover:"qq-upload-button-hover",buttonFocus:"qq-upload-button-focus"},chunking:{enabled:!1,concurrent:{enabled:!1},mandatory:!1,paramNames:{partIndex:"qqpartindex",partByteOffset:"qqpartbyteoffset",chunkSize:"qqchunksize",totalFileSize:"qqtotalfilesize",totalParts:"qqtotalparts"},partSize:function(n){return 2e6},success:{endpoint:null,headers:function(n){return null},jsonPayload:!1,method:"POST",params:function(n){return null},resetOnStatus:[]}},resume:{enabled:!1,recordsExpireIn:7,paramNames:{resuming:"qqresume"},customKeys:function(n){return[]}},formatFileName:function(n){return n},text:{defaultResponseError:"Upload failure reason unknown",fileInputTitle:"file input",sizeSymbols:["kB","MB","GB","TB","PB","EB"]},deleteFile:{enabled:!1,method:"DELETE",endpoint:"/server/upload",customHeaders:{},params:{}},cors:{expected:!1,sendCredentials:!1,allowXdr:!1},blobs:{defaultName:"misc_data"},paste:{targetElement:null,defaultName:"pasted_image"},camera:{ios:!1,button:null},extraButtons:[],session:{endpoint:null,params:{},customHeaders:{},refreshOnReset:!0},form:{element:"qq-form",autoUpload:!1,interceptSubmit:!0},scaling:{customResizer:null,sendOriginal:!0,orient:!0,defaultType:null,defaultQuality:80,failureText:"Failed to scale",includeExif:!1,sizes:[]},workarounds:{iosEmptyVideos:!0,ios8SafariUploads:!0,ios8BrowserCrash:!1}},qq.extend(this._options,e,!0),this._buttons=[],this._extraButtonSpecs={},this._buttonIdsForFileIds=[],this._wrapCallbacks(),this._disposeSupport=new qq.DisposeSupport,this._storedIds=[],this._autoRetries=[],this._retryTimeouts=[],this._preventRetries=[],this._thumbnailUrls=[],this._netUploadedOrQueued=0,this._netUploaded=0,this._uploadData=this._createUploadDataTracker(),this._initFormSupportAndParams(),this._customHeadersStore=this._createStore(this._options.request.customHeaders),this._deleteFileCustomHeadersStore=this._createStore(this._options.deleteFile.customHeaders),this._deleteFileParamsStore=this._createStore(this._options.deleteFile.params),this._endpointStore=this._createStore(this._options.request.endpoint),this._deleteFileEndpointStore=this._createStore(this._options.deleteFile.endpoint),this._handler=this._createUploadHandler(),this._deleteHandler=qq.DeleteFileAjaxRequester&&this._createDeleteHandler(),this._options.button&&(this._defaultButtonId=this._createUploadButton({element:this._options.button,title:this._options.text.fileInputTitle}).getButtonId()),this._generateExtraButtonSpecs(),this._handleCameraAccess(),this._options.paste.targetElement&&(qq.PasteSupport?this._pasteHandler=this._createPasteHandler():this.log("Paste support module not found","error")),this._options.warnBeforeUnload&&this._preventLeaveInProgress(),this._imageGenerator=qq.ImageGenerator&&new qq.ImageGenerator(qq.bind(this.log,this)),this._refreshSessionData(),this._succeededSinceLastAllComplete=[],this._failedSinceLastAllComplete=[],this._scaler=qq.Scaler&&new qq.Scaler(this._options.scaling,qq.bind(this.log,this))||{},this._scaler.enabled&&(this._customNewFileHandler=qq.bind(this._scaler.handleNewFile,this._scaler)),qq.TotalProgress&&qq.supportedFeatures.progressBar&&(this._totalProgress=new qq.TotalProgress(qq.bind(this._onTotalProgress,this),function(n){var i=t._uploadData.retrieve({id:n});return i&&i.size||0})),this._currentItemLimit=this._options.validation.itemLimit,this._customResumeDataStore=this._createStore()},qq.FineUploaderBasic.prototype=qq.basePublicApi,qq.extend(qq.FineUploaderBasic.prototype,qq.basePrivateApi)}(),qq.AjaxRequester=function(e){var t,n,i=[],a={},r={acceptHeader:null,validMethods:["PATCH","POST","PUT"],method:"POST",contentType:"application/x-www-form-urlencoded",maxConnections:3,customHeaders:{},endpointStore:{},paramsStore:{},mandatedParams:{},allowXRequestedWithAndCacheControl:!0,successfulResponseCodes:{DELETE:[200,202,204],PATCH:[200,201,202,203,204],POST:[200,201,202,203,204],PUT:[200,201,202,203,204],GET:[200]},cors:{expected:!1,sendCredentials:!1},log:function(x,F){},onSend:function(x){},onComplete:function(x,F,C){},onProgress:null};if(qq.extend(r,e),t=r.log,qq.indexOf(r.validMethods,r.method)<0)throw new Error("'"+r.method+"' is not a supported method for this type of request!");function l(){return qq.indexOf(["GET","POST","HEAD"],r.method)>=0}function s(x){var F=!1;return qq.each(F,function(C,D){if(qq.indexOf(["Accept","Accept-Language","Content-Language","Content-Type"],D)<0)return F=!0,!1}),F}function c(x){return r.cors.expected&&x.withCredentials===void 0}function f(){var x;return(window.XMLHttpRequest||window.ActiveXObject)&&(x=qq.createXhrInstance(),x.withCredentials===void 0&&(x=new XDomainRequest,x.onload=function(){},x.onerror=function(){},x.ontimeout=function(){},x.onprogress=function(){})),x}function h(x,F){var C=a[x]&&a[x].xhr;return C||(F?C=F:r.cors.expected?C=f():C=qq.createXhrInstance(),a[x].xhr=C),C}function S(x){var F=qq.indexOf(i,x),C=r.maxConnections,D;delete a[x],i.splice(F,1),i.length>=C&&F<C&&(D=i[C-1],u(D))}function q(x,F){var C=h(x),D=r.method,I=F===!0;S(x),I?t(D+" request for "+x+" has failed","error"):!c(C)&&!y(C.status)&&(I=!0,t(D+" request for "+x+" has failed - response code "+C.status,"error")),r.onComplete(x,C,I)}function o(x){var F=a[x].additionalParams,C=r.mandatedParams,D;return r.paramsStore.get&&(D=r.paramsStore.get(x)),F&&qq.each(F,function(I,U){D=D||{},D[I]=U}),C&&qq.each(C,function(I,U){D=D||{},D[I]=U}),D}function u(x,F){var C=h(x,F),D=r.method,I=o(x),U=a[x].payload,A;return r.onSend(x),A=p(x,I,a[x].additionalQueryParams),c(C)?(C.onload=g(x),C.onerror=d(x)):C.onreadystatechange=m(x),b(x),C.open(D,A,!0),r.cors.expected&&r.cors.sendCredentials&&!c(C)&&(C.withCredentials=!0),_(x),t("Sending "+D+" request for "+x),U?C.send(U):n||!I?C.send():I&&r.contentType&&r.contentType.toLowerCase().indexOf("application/x-www-form-urlencoded")>=0?C.send(qq.obj2url(I,"")):I&&r.contentType&&r.contentType.toLowerCase().indexOf("application/json")>=0?C.send(JSON.stringify(I)):C.send(I),C}function p(x,F,C){var D=r.endpointStore.get(x),I=a[x].addToPath;return I!=null&&(D+="/"+I),n&&F&&(D=qq.obj2url(F,D)),C&&(D=qq.obj2url(C,D)),D}function m(x){return function(){h(x).readyState===4&&q(x)}}function b(x){var F=r.onProgress;F&&(h(x).upload.onprogress=function(C){C.lengthComputable&&F(x,C.loaded,C.total)})}function g(x){return function(){q(x)}}function d(x){return function(){q(x,!0)}}function _(x){var F=h(x),C=r.customHeaders,D=a[x].additionalHeaders||{},I=r.method,U={};c(F)||(r.acceptHeader&&F.setRequestHeader("Accept",r.acceptHeader),r.allowXRequestedWithAndCacheControl&&(!r.cors.expected||!l()||s())&&(F.setRequestHeader("X-Requested-With","XMLHttpRequest"),F.setRequestHeader("Cache-Control","no-cache")),r.contentType&&(I==="POST"||I==="PUT")&&F.setRequestHeader("Content-Type",r.contentType),qq.extend(U,qq.isFunction(C)?C(x):C),qq.extend(U,D),qq.each(U,function(A,B){F.setRequestHeader(A,B)}))}function y(x){return qq.indexOf(r.successfulResponseCodes[r.method],x)>=0}function w(x,F,C,D,I,U,A){a[x]={addToPath:C,additionalParams:D,additionalQueryParams:I,additionalHeaders:U,payload:A};var B=i.push(x);if(B<=r.maxConnections)return u(x,F)}n=r.method==="GET"||r.method==="DELETE",qq.extend(this,{initTransport:function(x){var F,C,D,I,U,A;return{withPath:function(B){return F=B,this},withParams:function(B){return C=B,this},withQueryParams:function(B){return A=B,this},withHeaders:function(B){return D=B,this},withPayload:function(B){return I=B,this},withCacheBuster:function(){return U=!0,this},send:function(B){return U&&qq.indexOf(["GET","DELETE"],r.method)>=0&&(C.qqtimestamp=new Date().getTime()),w(x,B,F,C,A,D,I)}}},canceled:function(x){S(x)}})},qq.UploadHandler=function(e){var t=e.proxy,n={},i=t.onCancel,a=t.getName;qq.extend(this,{add:function(r,l){n[r]=l,n[r].temp={}},cancel:function(r){var l=this,s=new qq.Promise,c=i(r,a(r),s);c.then(function(){l.isValid(r)&&(n[r].canceled=!0,l.expunge(r)),s.success()})},expunge:function(r){delete n[r]},getThirdPartyFileId:function(r){return n[r].key},isValid:function(r){return n[r]!==void 0},reset:function(){n={}},_getFileState:function(r){return n[r]},_setThirdPartyFileId:function(r,l){n[r].key=l},_wasCanceled:function(r){return!!n[r].canceled}})},qq.UploadHandlerController=function(e,t){var n=this,i=!1,a=!1,r,l,s,c={paramsStore:{},maxConnections:3,chunking:{enabled:!1,multiple:{enabled:!1}},log:function(o,u){},onProgress:function(o,u,p,m){},onComplete:function(o,u,p,m){},onCancel:function(o,u){},onUploadPrep:function(o){},onUpload:function(o,u){},onUploadChunk:function(o,u,p){},onUploadChunkSuccess:function(o,u,p,m){},onAutoRetry:function(o,u,p,m){},onResume:function(o,u,p,m){},onUuidChanged:function(o,u){},getName:function(o){},setSize:function(o,u){},isQueued:function(o){},getIdsInProxyGroup:function(o){},getIdsInBatch:function(o){},isInProgress:function(o){}},f={done:function(o,u,p,m){var b=s._getChunkData(o,u);s._getFileState(o).attemptingResume=!1,delete s._getFileState(o).temp.chunkProgress[u],s._getFileState(o).loaded+=b.size,c.onUploadChunkSuccess(o,s._getChunkDataForCallback(b),p,m)},finalize:function(o){var u=c.getSize(o),p=c.getName(o);l("All chunks have been uploaded for "+o+" - finalizing...."),s.finalizeChunks(o).then(function(m,b){l("Finalize successful for "+o);var g=q.normalizeResponse(m,!0);c.onProgress(o,p,u,u),s._maybeDeletePersistedChunkData(o),q.cleanup(o,g,b)},function(m,b){var g=q.normalizeResponse(m,!1);l("Problem finalizing chunks for file ID "+o+" - "+g.error,"error"),(g.reset||b&&c.chunking.success.resetOnStatus.indexOf(b.status)>=0)&&f.reset(o),c.onAutoRetry(o,p,g,b)||q.cleanup(o,g,b)})},handleFailure:function(o,u,p,m){var b=c.getName(u);l("Chunked upload request failed for "+u+", chunk "+o),s.clearCachedChunk(u,o);var g=q.normalizeResponse(p,!1),d;if(g.reset)f.reset(u);else{var _=s._getFileState(u).chunking.inProgress;d=_?qq.indexOf(_,o):-1,d>=0&&(s._getFileState(u).chunking.inProgress.splice(d,1),s._getFileState(u).chunking.remaining.unshift(o))}s._getFileState(u).temp.ignoreFailure||(a&&(s._getFileState(u).temp.ignoreFailure=!0,l(qq.format("Going to attempt to abort these chunks: {}. These are currently in-progress: {}.",JSON.stringify(Object.keys(s._getXhrs(u))),JSON.stringify(s._getFileState(u).chunking.inProgress))),qq.each(s._getXhrs(u),function(y,w){l(qq.format("Attempting to abort file {}.{}. XHR readyState {}. ",u,y,w.readyState)),w.abort(),w._cancelled=!0}),s.moveInProgressToRemaining(u),h.free(u,!0)),c.onAutoRetry(u,b,g,m)||q.cleanup(u,g,m))},hasMoreParts:function(o){return!!s._getFileState(o).chunking.remaining.length},nextPart:function(o){var u=s._getFileState(o).chunking.remaining.shift();return u>=s._getTotalChunks(o)&&(u=null),u},reset:function(o){l("Server or callback has ordered chunking effort to be restarted on next attempt for item ID "+o,"error"),s._maybeDeletePersistedChunkData(o),s.reevaluateChunking(o),s._getFileState(o).loaded=0,s._getFileState(o).attemptingResume=!1},sendNext:function(o){var u=c.getSize(o),p=c.getName(o),m=f.nextPart(o),b=s._getChunkData(o,m),g=s._getFileState(o),d=g.attemptingResume,_=g.chunking.inProgress||[];if(g.loaded==null&&(g.loaded=0),d&&c.onResume(o,p,b,g.customResumeData)===!1&&(f.reset(o),m=f.nextPart(o),b=s._getChunkData(o,m),d=!1),m==null&&_.length===0)f.finalize(o);else{_.push(m),s._getFileState(o).chunking.inProgress=_,a&&h.open(o,m),a&&h.available()&&s._getFileState(o).chunking.remaining.length&&f.sendNext(o),b.blob.size===0&&(l(qq.format("Chunk {} for file {} will not be uploaded, zero sized chunk.",m,o),"error"),f.handleFailure(m,o,"File is no longer available",null));var y=c.onUploadChunk(o,p,s._getChunkDataForCallback(b));y.then(function(w){if(!c.isInProgress(o))l(qq.format("Not sending chunked upload request for item {}.{} - no longer in progress.",o,m));else{l(qq.format("Sending chunked upload request for item {}.{}, bytes {}-{} of {}.",o,m,b.start+1,b.end,u));var x={chunkIdx:m,id:o,overrides:w,resuming:d};s.uploadChunk(x).then(function(C,D){l("Chunked upload request succeeded for "+o+", chunk "+m),s.clearCachedChunk(o,m);var I=s._getFileState(o).chunking.inProgress||[],U=q.normalizeResponse(C,!0),A=qq.indexOf(I,m);l(qq.format("Chunk {} for file {} uploaded successfully.",m,o)),f.done(o,m,U,D),A>=0&&I.splice(A,1),s._maybePersistChunkedState(o),!f.hasMoreParts(o)&&I.length===0?f.finalize(o):f.hasMoreParts(o)?f.sendNext(o):l(qq.format("File ID {} has no more chunks to send and these chunk indexes are still marked as in-progress: {}",o,JSON.stringify(I)))},function(C,D){f.handleFailure(m,o,C,D)}).done(function(){s.clearXhr(o,m)})}},function(w){f.handleFailure(m,o,w,null)})}}},h={_open:[],_openChunks:{},_waiting:[],available:function(){var o=c.maxConnections,u=0,p=0;return qq.each(h._openChunks,function(m,b){u++,p+=b.length}),o-(h._open.length-u+p)},free:function(o,u){var p=!u,m=qq.indexOf(h._waiting,o),b=qq.indexOf(h._open,o),g;delete h._openChunks[o],q.getProxyOrBlob(o)instanceof qq.BlobProxy&&(l("Generated blob upload has ended for "+o+", disposing generated blob."),delete s._getFileState(o).file),m>=0?h._waiting.splice(m,1):p&&b>=0&&(h._open.splice(b,1),g=h._waiting.shift(),g>=0&&(h._open.push(g),q.start(g)))},getWaitingOrConnected:function(){var o=[];return qq.each(h._openChunks,function(u,p){p&&p.length&&o.push(parseInt(u))}),qq.each(h._open,function(u,p){h._openChunks[p]||o.push(parseInt(p))}),o=o.concat(h._waiting),o},isUsingConnection:function(o){return qq.indexOf(h._open,o)>=0},open:function(o,u){return u==null&&h._waiting.push(o),h.available()?(u==null?(h._waiting.pop(),h._open.push(o)):function(){var p=h._openChunks[o]||[];p.push(u),h._openChunks[o]=p}(),!0):!1},reset:function(){h._waiting=[],h._open=[]}},S={send:function(o,u){var p=s._getFileState(o);if(!p){l("Ignoring send request as this upload may have been cancelled, File ID "+o,"warn");return}p.loaded=0,l("Sending simple upload request for "+o),s.uploadFile(o).then(function(m,b){l("Simple upload request succeeded for "+o);var g=q.normalizeResponse(m,!0),d=c.getSize(o);c.onProgress(o,u,d,d),q.maybeNewUuid(o,g),q.cleanup(o,g,b)},function(m,b){l("Simple upload request failed for "+o);var g=q.normalizeResponse(m,!1);c.onAutoRetry(o,u,g,b)||q.cleanup(o,g,b)})}},q={cancel:function(o){l("Cancelling "+o),c.paramsStore.remove(o),h.free(o)},cleanup:function(o,u,p){var m=c.getName(o);c.onComplete(o,m,u,p),s._getFileState(o)&&s._clearXhrs&&s._clearXhrs(o),h.free(o)},getProxyOrBlob:function(o){return s.getProxy&&s.getProxy(o)||s.getFile&&s.getFile(o)},initHandler:function(){var o=t?qq[t]:qq.traditional,u=qq.supportedFeatures.ajaxUploading?"Xhr":"Form";s=new o[u+"UploadHandler"](c,{getCustomResumeData:c.getCustomResumeData,getDataByUuid:c.getDataByUuid,getName:c.getName,getSize:c.getSize,getUuid:c.getUuid,log:l,onCancel:c.onCancel,onProgress:c.onProgress,onUuidChanged:c.onUuidChanged,onFinalizing:function(p){c.setStatus(p,qq.status.UPLOAD_FINALIZING)}}),s._removeExpiredChunkingRecords&&s._removeExpiredChunkingRecords()},isDeferredEligibleForUpload:function(o){return c.isQueued(o)},maybeDefer:function(o,u){if(u&&!s.getFile(o)&&u instanceof qq.BlobProxy)c.onUploadPrep(o),l("Attempting to generate a blob on-demand for "+o),u.create().then(function(p){l("Generated an on-demand blob for "+o),s.updateBlob(o,p),c.setSize(o,p.size),s.reevaluateChunking(o),q.maybeSendDeferredFiles(o)},function(p){var m={};p&&(m.error=p),l(qq.format("Failed to generate blob for ID {}.  Error message: {}.",o,p),"error"),c.onComplete(o,c.getName(o),qq.extend(m,r),null),q.maybeSendDeferredFiles(o),h.free(o)});else return q.maybeSendDeferredFiles(o);return!1},maybeSendDeferredFiles:function(o){var u=c.getIdsInProxyGroup(o),p=!1;return u&&u.length?(l("Maybe ready to upload proxy group file "+o),qq.each(u,function(m,b){if(q.isDeferredEligibleForUpload(b)&&s.getFile(b))p=b===o,q.now(b);else if(q.isDeferredEligibleForUpload(b))return!1})):(p=!0,q.now(o)),p},maybeNewUuid:function(o,u){u.newUuid!==void 0&&c.onUuidChanged(o,u.newUuid)},normalizeResponse:function(o,u){var p=o;return qq.isObject(o)||(p={},qq.isString(o)&&!u&&(p.error=o)),p.success=u,p},now:function(o){var u=c.getName(o);if(!n.isValid(o))throw new qq.Error(o+" is not a valid file ID to upload!");c.onUpload(o,u).then(function(p){p&&p.pause?(c.setStatus(o,qq.status.PAUSED),s.pause(o),h.free(o)):i&&s._shouldChunkThisFile(o)?f.sendNext(o):S.send(o,u)},function(p){if(p=p||{},l(o+" upload start aborted due to rejected onUpload Promise - details: "+p,"error"),!c.onAutoRetry(o,u,p.responseJSON||{})){var m=q.normalizeResponse(p.responseJSON,!1);q.cleanup(o,m)}})},start:function(o){var u=q.getProxyOrBlob(o);return u?q.maybeDefer(o,u):(q.now(o),!0)}};qq.extend(this,{add:function(o,u){s.add.apply(this,arguments)},upload:function(o){return h.open(o)?q.start(o):!1},retry:function(o){return a&&(s._getFileState(o).temp.ignoreFailure=!1),h.isUsingConnection(o)?q.start(o):n.upload(o)},cancel:function(o){var u=s.cancel(o);qq.isGenericPromise(u)?u.then(function(){q.cancel(o)}):u!==!1&&q.cancel(o)},cancelAll:function(){var o=h.getWaitingOrConnected(),u;if(o.length)for(u=o.length-1;u>=0;u--)n.cancel(o[u]);h.reset()},getFile:function(o){return s.getProxy&&s.getProxy(o)?s.getProxy(o).referenceBlob:s.getFile&&s.getFile(o)},isProxied:function(o){return!!(s.getProxy&&s.getProxy(o))},getInput:function(o){if(s.getInput)return s.getInput(o)},reset:function(){l("Resetting upload handler"),n.cancelAll(),h.reset(),s.reset()},expunge:function(o){if(n.isValid(o))return s.expunge(o)},isValid:function(o){return s.isValid(o)},hasResumeRecord:function(o){var u=s.isValid(o)&&s._getLocalStorageId&&s._getLocalStorageId(o);return u?!!localStorage.getItem(u):!1},getResumableFilesData:function(){return s.getResumableFilesData?s.getResumableFilesData():[]},getThirdPartyFileId:function(o){if(n.isValid(o))return s.getThirdPartyFileId(o)},pause:function(o){return n.isResumable(o)&&s.pause&&n.isValid(o)&&s.pause(o)?(h.free(o),s.moveInProgressToRemaining(o),!0):!1},isAttemptingResume:function(o){return!!s.isAttemptingResume&&s.isAttemptingResume(o)},isResumable:function(o){return!!s.isResumable&&s.isResumable(o)}}),qq.extend(c,e),l=c.log,i=c.chunking.enabled&&qq.supportedFeatures.chunking,a=i&&c.chunking.concurrent.enabled,r=function(){var o={};return o[c.preventRetryParam]=!0,o}(),q.initHandler()},qq.WindowReceiveMessage=function(e){var t={log:function(i,a){}},n={};qq.extend(t,e),qq.extend(this,{receiveMessage:function(i,a){var r=function(l){a(l.data)};window.postMessage?n[i]=qq(window).attach("message",r):log("iframe message passing not supported in this browser!","error")},stopReceivingMessages:function(i){if(window.postMessage){var a=n[i];a&&a()}}})},qq.FormUploadHandler=function(e){var t=e.options,n=this,i=e.proxy,a=qq.getUniqueId(),r={},l={},s={},c=t.isCors,f=t.inputName,h=i.getUuid,S=i.log,q=new qq.WindowReceiveMessage({log:S});function o(b){delete l[b],c&&(clearTimeout(s[b]),delete s[b],q.stopReceivingMessages(b));var g=document.getElementById(n._getIframeName(b));g&&(g.setAttribute("src","javascript:false;"),qq(g).remove())}function u(b){return b.split("_")[0]}function p(b){var g=qq.toElement("<iframe src='javascript:false;' name='"+b+"' />");return g.setAttribute("id",b),g.style.display="none",document.body.appendChild(g),g}function m(b,g){var d=b.id,_=u(d),y=h(_);r[y]=g,l[_]=qq(b).attach("load",function(){n.getInput(_)&&(S("Received iframe load event for CORS upload request (iframe name "+d+")"),s[d]=setTimeout(function(){var w="No valid message received from loaded iframe for iframe name "+d;S(w,"error"),g({error:w})},1e3))}),q.receiveMessage(d,function(w){S("Received the following window message: '"+w+"'"),u(d);var x=n._parseJsonResponse(w),F=x.uuid,C;F&&r[F]?(S("Handling response for iframe name "+d),clearTimeout(s[d]),delete s[d],n._detachLoadEvent(d),C=r[F],delete r[F],q.stopReceivingMessages(d),C(x)):F||S("'"+w+"' does not contain a UUID - ignoring.")})}qq.extend(this,new qq.UploadHandler(e)),qq.override(this,function(b){return{add:function(g,d){b.add(g,{input:d}),d.setAttribute("name",f),d.parentNode&&qq(d).remove()},expunge:function(g){o(g),b.expunge(g)},isValid:function(g){return b.isValid(g)&&n._getFileState(g).input!==void 0}}}),qq.extend(this,{getInput:function(b){return n._getFileState(b).input},_attachLoadEvent:function(b,g){var d;c?m(b,g):l[b.id]=qq(b).attach("load",function(){if(S("Received response for "+b.id),!!b.parentNode){try{if(b.contentDocument&&b.contentDocument.body&&b.contentDocument.body.innerHTML=="false")return}catch(_){S("Error when attempting to access iframe during handling of upload response ("+_.message+")","error"),d={success:!1}}g(d)}})},_createIframe:function(b){var g=n._getIframeName(b);return p(g)},_detachLoadEvent:function(b){l[b]!==void 0&&(l[b](),delete l[b])},_getIframeName:function(b){return b+"_"+a},_initFormForUpload:function(b){var g=b.method,d=b.endpoint,_=b.params,y=b.paramsInBody,w=b.targetName,x=qq.toElement("<form method='"+g+"' enctype='multipart/form-data'></form>"),F=d;return y?qq.obj2Inputs(_,x):F=qq.obj2url(_,d),x.setAttribute("action",F),x.setAttribute("target",w),x.style.display="none",document.body.appendChild(x),x},_parseJsonResponse:function(b){var g={};try{g=qq.parseJson(b)}catch(d){S("Error when attempting to parse iframe upload response ("+d.message+")","error")}return g}})},qq.XhrUploadHandler=function(e){var t=this,n=e.options.namespace,i=e.proxy,a=e.options.chunking,r=function(d){var _=t._getFileState(d);if(_.chunkSize)return _.chunkSize;var y=a.partSize;return qq.isFunction(y)&&(y=y(d,h(d))),_.chunkSize=y,y},l=e.options.resume,s=a&&e.options.chunking.enabled&&qq.supportedFeatures.chunking,c=l&&e.options.resume.enabled&&s&&qq.supportedFeatures.resume,f=i.getName,h=i.getSize,S=i.getUuid,q=i.getEndpoint,o=i.getDataByUuid,u=i.onUuidChanged,p=i.onProgress,m=i.log,b=i.getCustomResumeData;function g(d){qq.each(t._getXhrs(d),function(_,y){var w=t._getAjaxRequester(d,_);y.onreadystatechange=null,y.upload.onprogress=null,y.abort(),w&&w.canceled&&w.canceled(d)})}qq.extend(this,new qq.UploadHandler(e)),qq.override(this,function(d){return{add:function(_,y){if(qq.isFile(y)||qq.isBlob(y))d.add(_,{file:y});else if(y instanceof qq.BlobProxy)d.add(_,{proxy:y});else throw new Error("Passed obj is not a File, Blob, or proxy");t._initTempState(_),c&&t._maybePrepareForResume(_)},expunge:function(_){g(_),t._maybeDeletePersistedChunkData(_),t._clearXhrs(_),d.expunge(_)}}}),qq.extend(this,{clearCachedChunk:function(d,_){var y=t._getFileState(d);y&&delete y.temp.cachedChunks[_]},clearXhr:function(d,_){var y=t._getFileState(d).temp;y.xhrs&&delete y.xhrs[_],y.ajaxRequesters&&delete y.ajaxRequesters[_]},finalizeChunks:function(d,_){var y=t._getTotalChunks(d)-1,w=t._getXhr(d,y);return _?new qq.Promise().success(_(w),w):new qq.Promise().success({},w)},getFile:function(d){return t.isValid(d)&&t._getFileState(d).file},getProxy:function(d){return t.isValid(d)&&t._getFileState(d).proxy},getResumableFilesData:function(){var d=[];return t._iterateResumeRecords(function(_,y){t.moveInProgressToRemaining(null,y.chunking.inProgress,y.chunking.remaining);var w={name:y.name,remaining:y.chunking.remaining,size:y.size,uuid:y.uuid};y.key&&(w.key=y.key),y.customResumeData&&(w.customResumeData=y.customResumeData),d.push(w)}),d},isAttemptingResume:function(d){return t._getFileState(d).attemptingResume},isResumable:function(d){return!!a&&t.isValid(d)&&!t._getFileState(d).notResumable},moveInProgressToRemaining:function(d,_,y){var w=t._getFileState(d)||{},x=w.chunking||{},F=_||x.inProgress,C=y||x.remaining;F&&(m(qq.format("Moving these chunks from in-progress {}, to remaining.",JSON.stringify(F))),F.reverse(),qq.each(F,function(D,I){C.unshift(I)}),F.length=0)},pause:function(d){if(t.isValid(d))return m(qq.format("Aborting XHR upload for {} '{}' due to pause instruction.",d,f(d))),t._getFileState(d).paused=!0,g(d),!0},reevaluateChunking:function(d){if(a&&t.isValid(d)){var _=t._getFileState(d),y,w;if(delete _.chunking,_.chunking={},y=t._getTotalChunks(d),y>1||a.mandatory){for(_.chunking.enabled=!0,_.chunking.parts=y,_.chunking.remaining=[],w=0;w<y;w++)_.chunking.remaining.push(w);t._initTempState(d)}else _.chunking.enabled=!1}},updateBlob:function(d,_){t.isValid(d)&&(t._getFileState(d).file=_)},_clearXhrs:function(d){var _=t._getFileState(d).temp;qq.each(_.ajaxRequesters,function(y){delete _.ajaxRequesters[y]}),qq.each(_.xhrs,function(y){delete _.xhrs[y]})},_createXhr:function(d,_){return t._registerXhr(d,_,qq.createXhrInstance())},_getAjaxRequester:function(d,_){var y=_??-1;return t._getFileState(d).temp.ajaxRequesters[y]},_getChunkData:function(d,_){var y=r(d),w=h(d),x=t.getFile(d),F=y*_,C=F+y>=w?w:F+y,D=t._getTotalChunks(d),I=this._getFileState(d).temp.cachedChunks,U=I[_]||qq.sliceBlob(x,F,C);return I[_]=U,{part:_,start:F,end:C,count:D,blob:U,size:C-F}},_getChunkDataForCallback:function(d){return{partIndex:d.part,startByte:d.start+1,endByte:d.end,totalParts:d.count}},_getLocalStorageId:function(d){var _="5.0",y=f(d),w=h(d),x=r(d),F=q(d),C=l.customKeys(d),D=qq.format("qq{}resume{}-{}-{}-{}-{}",n,_,y,w,x,F);return C.forEach(function(I){D+="-"+I}),D},_getMimeType:function(d){return t.getFile(d).type},_getPersistableData:function(d){return t._getFileState(d).chunking},_getTotalChunks:function(d){if(a){var _=h(d),y=r(d);return Math.ceil(_/y)}},_getXhr:function(d,_){var y=_??-1;return t._getFileState(d).temp.xhrs[y]},_getXhrs:function(d){return t._getFileState(d).temp.xhrs},_iterateResumeRecords:function(d){c&&qq.each(localStorage,function(_,y){if(_.indexOf(qq.format("qq{}resume",n))===0){var w=JSON.parse(y);d(_,w)}})},_initTempState:function(d){t._getFileState(d).temp={ajaxRequesters:{},chunkProgress:{},xhrs:{},cachedChunks:{}}},_markNotResumable:function(d){t._getFileState(d).notResumable=!0},_maybeDeletePersistedChunkData:function(d){var _;return c&&t.isResumable(d)&&(_=t._getLocalStorageId(d),_&&localStorage.getItem(_))?(localStorage.removeItem(_),!0):!1},_maybePrepareForResume:function(d){var _=t._getFileState(d),y,w;c&&_.key===void 0&&(y=t._getLocalStorageId(d),w=localStorage.getItem(y),w&&(w=JSON.parse(w),o(w.uuid)?t._markNotResumable(d):(m(qq.format("Identified file with ID {} and name of {} as resumable.",d,f(d))),u(d,w.uuid),_.key=w.key,_.chunking=w.chunking,_.loaded=w.loaded,_.customResumeData=w.customResumeData,_.attemptingResume=!0,t.moveInProgressToRemaining(d))))},_maybePersistChunkedState:function(d){var _=t._getFileState(d),y,w;if(c&&t.isResumable(d)){var x=b(d);y=t._getLocalStorageId(d),w={name:f(d),size:h(d),uuid:S(d),key:_.key,chunking:_.chunking,loaded:_.loaded,lastUpdated:Date.now()},x&&(w.customResumeData=x);try{localStorage.setItem(y,JSON.stringify(w))}catch(F){m(qq.format("Unable to save resume data for '{}' due to error: '{}'.",d,F.toString()),"warn")}}},_registerProgressHandler:function(d,_,y){var w=t._getXhr(d,_),x=f(d),F={simple:function(C,D){var I=h(d);C===D?p(d,x,I,I):p(d,x,C>=I?I-1:C,I)},chunked:function(C,D){var I=t._getFileState(d).temp.chunkProgress,U=t._getFileState(d).loaded,A=C,B=D,j=h(d),Y=A-(B-y),W=U;I[_]=Y,qq.each(I,function(ne,Z){W+=Z}),p(d,x,W,j)}};w.upload.onprogress=function(C){if(C.lengthComputable){var D=y==null?"simple":"chunked";F[D](C.loaded,C.total)}}},_registerXhr:function(d,_,y,w){var x=_??-1,F=t._getFileState(d).temp;return F.xhrs=F.xhrs||{},F.ajaxRequesters=F.ajaxRequesters||{},F.xhrs[x]=y,w&&(F.ajaxRequesters[x]=w),y},_removeExpiredChunkingRecords:function(){var d=l.recordsExpireIn;t._iterateResumeRecords(function(_,y){var w=new Date(y.lastUpdated);w.setDate(w.getDate()+d),w.getTime()<=Date.now()&&(m("Removing expired resume record with key "+_),localStorage.removeItem(_))})},_shouldChunkThisFile:function(d){var _=t._getFileState(d);if(_)return _.chunking||t.reevaluateChunking(d),_.chunking.enabled}})},qq.DeleteFileAjaxRequester=function(e){var t,n={method:"DELETE",uuidParamName:"qquuid",endpointStore:{},maxConnections:3,customHeaders:function(a){return{}},paramsStore:{},cors:{expected:!1,sendCredentials:!1},log:function(a,r){},onDelete:function(a){},onDeleteComplete:function(a,r,l){}};qq.extend(n,e);function i(){return n.method.toUpperCase()==="POST"?{_method:"DELETE"}:{}}t=qq.extend(this,new qq.AjaxRequester({acceptHeader:"application/json",validMethods:["POST","DELETE"],method:n.method,endpointStore:n.endpointStore,paramsStore:n.paramsStore,mandatedParams:i(),maxConnections:n.maxConnections,customHeaders:function(a){return n.customHeaders.get(a)},log:n.log,onSend:n.onDelete,onComplete:n.onDeleteComplete,cors:n.cors})),qq.extend(this,{sendDelete:function(a,r,l){var s=l||{};n.log("Submitting delete file request for "+a),n.method==="DELETE"?t.initTransport(a).withPath(r).withParams(s).send():(s[n.uuidParamName]=r,t.initTransport(a).withParams(s).send())}})},function(){function e(c){var f=c.naturalWidth,h=c.naturalHeight,S=document.createElement("canvas"),q;return f*h>1024*1024?(S.width=S.height=1,q=S.getContext("2d"),q.drawImage(c,-f+1,0),q.getImageData(0,0,1,1).data[3]===0):!1}function t(c,f,h){var S=document.createElement("canvas"),q=0,o=h,u=h,p,m,b,g;for(S.width=1,S.height=h,p=S.getContext("2d"),p.drawImage(c,0,0),m=p.getImageData(0,0,1,h).data;u>q;)b=m[(u-1)*4+3],b===0?o=u:q=u,u=o+q>>1;return g=u/h,g===0?1:g}function n(c,f,h,S){var q=document.createElement("canvas"),o=h.mime||"image/jpeg",u=new qq.Promise;return a(c,f,q,h,S).then(function(){u.success(q.toDataURL(o,h.quality||.8))}),u}function i(c){var f=5241e3;if(!qq.ios())throw new qq.Error("Downsampled dimensions can only be reliably calculated for iOS!");if(c.origHeight*c.origWidth>f)return{newHeight:Math.round(Math.sqrt(f*(c.origHeight/c.origWidth))),newWidth:Math.round(Math.sqrt(f*(c.origWidth/c.origHeight)))}}function a(c,f,h,S,q){var o=c.naturalWidth,u=c.naturalHeight,p=S.width,m=S.height,b=h.getContext("2d"),g=new qq.Promise,d;return b.save(),S.resize?r({blob:f,canvas:h,image:c,imageHeight:u,imageWidth:o,orientation:S.orientation,resize:S.resize,targetHeight:m,targetWidth:p}):(qq.supportedFeatures.unlimitedScaledImageSize||(d=i({origWidth:p,origHeight:m}),d&&(qq.log(qq.format("Had to reduce dimensions due to device limitations from {}w / {}h to {}w / {}h",p,m,d.newWidth,d.newHeight),"warn"),p=d.newWidth,m=d.newHeight)),l(h,p,m,S.orientation),qq.ios()?function(){e(c)&&(o/=2,u/=2);var _=1024,y=document.createElement("canvas"),w=q?t(c,o,u):1,x=Math.ceil(_*p/o),F=Math.ceil(_*m/u/w),C=0,D=0,I,U,A;for(y.width=y.height=_,I=y.getContext("2d");C<u;){for(U=0,A=0;U<o;)I.clearRect(0,0,_,_),I.drawImage(c,-U,-C),b.drawImage(y,0,0,_,_,A,D,x,F),U+=_,A+=x;C+=_,D+=F}b.restore(),y=I=null}():b.drawImage(c,0,0,p,m),h.qqImageRendered&&h.qqImageRendered(),g.success(),g)}function r(c){var f=c.blob,h=c.image,S=c.imageHeight,q=c.imageWidth,o=c.orientation,u=new qq.Promise,p=c.resize,m=document.createElement("canvas"),b=m.getContext("2d"),g=c.canvas,d=c.targetHeight,_=c.targetWidth;return l(m,q,S,o),g.height=d,g.width=_,b.drawImage(h,0,0),p({blob:f,height:d,image:h,sourceCanvas:m,targetCanvas:g,width:_}).then(function(){g.qqImageRendered&&g.qqImageRendered(),u.success()},u.failure),u}function l(c,f,h,S){switch(S){case 5:case 6:case 7:case 8:c.width=h,c.height=f;break;default:c.width=f,c.height=h}var q=c.getContext("2d");switch(S){case 2:q.translate(f,0),q.scale(-1,1);break;case 3:q.translate(f,h),q.rotate(Math.PI);break;case 4:q.translate(0,h),q.scale(1,-1);break;case 5:q.rotate(.5*Math.PI),q.scale(1,-1);break;case 6:q.rotate(.5*Math.PI),q.translate(0,-h);break;case 7:q.rotate(.5*Math.PI),q.translate(f,-h),q.scale(-1,1);break;case 8:q.rotate(-.5*Math.PI),q.translate(-f,0);break}}function s(c,f){var h=this;window.Blob&&c instanceof Blob&&function(){var S=new Image,q=window.URL&&window.URL.createObjectURL?window.URL:window.webkitURL&&window.webkitURL.createObjectURL?window.webkitURL:null;if(!q)throw Error("No createObjectURL function found to create blob url");S.src=q.createObjectURL(c),h.blob=c,c=S}(),!c.naturalWidth&&!c.naturalHeight&&(c.onload=function(){var S=h.imageLoadListeners;S&&(h.imageLoadListeners=null,setTimeout(function(){for(var q=0,o=S.length;q<o;q++)S[q]()},0))},c.onerror=f,this.imageLoadListeners=[]),this.srcImage=c}s.prototype.render=function(c,f){f=f||{};var h=this,S=this.srcImage.naturalWidth,q=this.srcImage.naturalHeight,o=f.width,u=f.height,p=f.maxWidth,m=f.maxHeight,b=!this.blob||this.blob.type==="image/jpeg",g=c.tagName.toLowerCase(),d;if(this.imageLoadListeners){this.imageLoadListeners.push(function(){h.render(c,f)});return}o&&!u?u=q*o/S<<0:u&&!o?o=S*u/q<<0:(o=S,u=q),p&&o>p&&(o=p,u=q*o/S<<0),m&&u>m&&(u=m,o=S*u/q<<0),d={width:o,height:u},qq.each(f,function(_,y){d[_]=y}),g==="img"?function(){var _=c.src;n(h.srcImage,h.blob,d,b).then(function(y){c.src=y,_===c.src&&c.onload()})}():g==="canvas"&&a(this.srcImage,this.blob,c,d,b),typeof this.onrender=="function"&&this.onrender(c)},qq.MegaPixImage=s}(),qq.ImageGenerator=function(e){function t(u){return u.tagName.toLowerCase()==="img"}function n(u){return u.tagName.toLowerCase()==="canvas"}function i(){return new Image().crossOrigin!==void 0}function a(){var u=document.createElement("canvas");return u.getContext&&u.getContext("2d")}function r(u){var p=u.split("/"),m=p[p.length-1].split("?")[0],b=qq.getExtension(m);switch(b=b&&b.toLowerCase(),b){case"jpeg":case"jpg":return"image/jpeg";case"png":return"image/png";case"bmp":return"image/bmp";case"gif":return"image/gif";case"tiff":case"tif":return"image/tiff"}}function l(u){var p=document.createElement("a"),m,b,g;return p.href=u,m=p.protocol,g=p.port,b=p.hostname,m.toLowerCase()!==window.location.protocol.toLowerCase()||b.toLowerCase()!==window.location.hostname.toLowerCase()||g!==window.location.port&&!qq.ie()}function s(u,p){u.onload=function(){u.onload=null,u.onerror=null,p.success(u)},u.onerror=function(){u.onload=null,u.onerror=null,e("Problem drawing thumbnail!","error"),p.failure(u,"Problem drawing thumbnail!")}}function c(u,p){u.qqImageRendered=function(){p.success(u)}}function f(u,p){var m=t(u)||n(u);return t(u)?s(u,p):n(u)?c(u,p):(p.failure(u),e(qq.format("Element container of type {} is not supported!",u.tagName),"error")),m}function h(u,p,m){var b=new qq.Promise,g=new qq.Identify(u,e),d=m.maxSize,_=m.orient==null?!0:m.orient,y=function(){p.onerror=null,p.onload=null,e("Could not render preview, file may be too large!","error"),b.failure(p,"Browser cannot render image!")};return g.isPreviewable().then(function(w){var x={parse:function(){return new qq.Promise().success()}},F=_?new qq.Exif(u,e):x,C=new qq.MegaPixImage(u,y);f(p,b)&&F.parse().then(function(D){var I=D&&D.Orientation;C.render(p,{maxWidth:d,maxHeight:d,orientation:I,mime:w,resize:m.customResizeFunction})},function(D){e(qq.format("EXIF data could not be parsed ({}).  Assuming orientation = 1.",D)),C.render(p,{maxWidth:d,maxHeight:d,mime:w,resize:m.customResizeFunction})})},function(){e("Not previewable"),b.failure(p,"Not previewable")}),b}function S(u,p,m,b,g){var d=new Image,_=new qq.Promise;f(d,_),l(u)&&(d.crossOrigin="anonymous"),d.src=u,_.then(function(){f(p,m);var w=new qq.MegaPixImage(d);w.render(p,{maxWidth:b,maxHeight:b,mime:r(u),resize:g})},m.failure)}function q(u,p,m,b){f(p,m),qq(p).css({maxWidth:b+"px",maxHeight:b+"px"}),p.src=u}function o(u,p,m){var b=new qq.Promise,g=m.scale,d=g?m.maxSize:null;return g&&t(p)?a()?l(u)&&!i()?q(u,p,b,d):S(u,p,b,d):q(u,p,b,d):n(p)?S(u,p,b,d):f(p,b)&&(p.src=u),b}qq.extend(this,{generate:function(u,p,m){return qq.isString(u)?(e("Attempting to update thumbnail based on server response."),o(u,p,m||{})):(e("Attempting to draw client-side image preview."),h(u,p,m||{}))}}),this._testing={},this._testing.isImg=t,this._testing.isCanvas=n,this._testing.isCrossOrigin=l,this._testing.determineMimeOfFileName=r},qq.Exif=function(e,t){var n=[274],i={274:{name:"Orientation",bytes:2}};function a(q){for(var o=0,u=0;q.length>0;)o+=parseInt(q.substring(0,2),16)*Math.pow(2,u),q=q.substring(2,q.length),u+=8;return o}function r(q,o){var u=q,p=o;return u===void 0&&(u=2,p=new qq.Promise),qq.readBlobToHex(e,u,4).then(function(m){var b=/^ffe([0-9])/.exec(m),g;b?b[1]!=="1"?(g=parseInt(m.slice(4,8),16),r(u+g+2,p)):p.success(u):p.failure("No EXIF header to be found!")}),p}function l(){var q=new qq.Promise;return qq.readBlobToHex(e,0,6).then(function(o){o.indexOf("ffd8")!==0?q.failure("Not a valid JPEG!"):r().then(function(u){q.success(u)},function(u){q.failure(u)})}),q}function s(q){var o=new qq.Promise;return qq.readBlobToHex(e,q+10,2).then(function(u){o.success(u==="4949")}),o}function c(q,o){var u=new qq.Promise;return qq.readBlobToHex(e,q+18,2).then(function(p){if(o)return u.success(a(p));u.success(parseInt(p,16))}),u}function f(q,o){var u=q+20,p=o*12;return qq.readBlobToHex(e,u,p)}function h(q){for(var o=[],u=0;u+24<=q.length;)o.push(q.slice(u,u+24)),u+=24;return o}function S(q,o){var u=16,p=qq.extend([],n),m={};return qq.each(o,function(b,g){var d=g.slice(0,4),_=q?a(d):parseInt(d,16),y=p.indexOf(_),w,x,F;if(y>=0&&(x=i[_].name,F=i[_].bytes,w=g.slice(u,u+F*2),m[x]=q?a(w):parseInt(w,16),p.splice(y,1)),p.length===0)return!1}),m}qq.extend(this,{parse:function(){var q=new qq.Promise,o=function(u){t(qq.format("EXIF header parse failed: '{}' ",u)),q.failure(u)};return l().then(function(u){t(qq.format("Moving forward with EXIF header parsing for '{}'",e.name===void 0?"blob":e.name)),s(u).then(function(p){t(qq.format("EXIF Byte order is {} endian",p?"little":"big")),c(u,p).then(function(m){t(qq.format("Found {} APP1 directory entries",m)),f(u,m).then(function(b){var g=h(b),d=S(p,g);t("Successfully parsed some EXIF tags"),q.success(d)},o)},o)},o)},o),q}}),this._testing={},this._testing.parseLittleEndian=a},qq.Identify=function(e,t){function n(i,a){var r=!1,l=[].concat(i);return qq.each(l,function(s,c){if(a.indexOf(c)===0)return r=!0,!1}),r}qq.extend(this,{isPreviewable:function(){var i=this,a=new qq.Promise,r=!1,l=e.name===void 0?"blob":e.name;return t(qq.format("Attempting to determine if {} can be rendered in this browser",l)),t("First pass: check type attribute of blob object."),this.isPreviewableSync()?(t("Second pass: check for magic bytes in file header."),qq.readBlobToHex(e,0,4).then(function(s){qq.each(i.PREVIEWABLE_MIME_TYPES,function(c,f){if(n(f,s))return(c!=="image/tiff"||qq.supportedFeatures.tiffPreviews)&&(r=!0,a.success(c)),!1}),t(qq.format("'{}' is {} able to be rendered in this browser",l,r?"":"NOT")),r||a.failure()},function(){t("Error reading file w/ name '"+l+"'.  Not able to be rendered in this browser."),a.failure()})):a.failure(),a},isPreviewableSync:function(){var i=e.type,a=qq.indexOf(Object.keys(this.PREVIEWABLE_MIME_TYPES),i)>=0,r=!1,l=e.name===void 0?"blob":e.name;return a&&(i==="image/tiff"?r=qq.supportedFeatures.tiffPreviews:r=!0),!r&&t(l+" is not previewable in this browser per the blob's type attr"),r}})},qq.Identify.prototype.PREVIEWABLE_MIME_TYPES={"image/jpeg":"ffd8ff","image/gif":"474946","image/png":"89504e","image/bmp":"424d","image/tiff":["49492a00","4d4d002a"]},qq.ImageValidation=function(e,t){function n(r){var l=!1;return qq.each(r,function(s,c){if(c>0)return l=!0,!1}),l}function i(){var r=new qq.Promise;return new qq.Identify(e,t).isPreviewable().then(function(){var l=new Image,s=window.URL&&window.URL.createObjectURL?window.URL:window.webkitURL&&window.webkitURL.createObjectURL?window.webkitURL:null;s?(l.onerror=function(){t("Cannot determine dimensions for image.  May be too large.","error"),r.failure()},l.onload=function(){r.success({width:this.width,height:this.height})},l.src=s.createObjectURL(e)):(t("No createObjectURL function available to generate image URL!","error"),r.failure())},r.failure),r}function a(r,l){var s;return qq.each(r,function(c,f){if(f>0){var h=/(max|min)(Width|Height)/.exec(c),S=h[2].charAt(0).toLowerCase()+h[2].slice(1),q=l[S];switch(h[1]){case"min":if(q<f)return s=c,!1;break;case"max":if(q>f)return s=c,!1;break}}}),s}this.validate=function(r){var l=new qq.Promise;return t("Attempting to validate image."),n(r)?i().then(function(s){var c=a(r,s);c?l.failure(c):l.success()},l.success):l.success(),l}},qq.Session=function(e){var t={endpoint:null,params:{},customHeaders:{},cors:{},addFileRecord:function(a){},log:function(a,r){}};qq.extend(t,e,!0);function n(a){if(qq.isArray(a))return!0;t.log("Session response is not an array.","error")}function i(a,r,l,s){var c=!1;r=r&&n(a),r&&qq.each(a,function(f,h){if(h.uuid==null)c=!0,t.log(qq.format("Session response item {} did not include a valid UUID - ignoring.",f),"error");else if(h.name==null)c=!0,t.log(qq.format("Session response item {} did not include a valid name - ignoring.",f),"error");else try{return t.addFileRecord(h),!0}catch(S){c=!0,t.log(S.message,"error")}return!1}),s[r&&!c?"success":"failure"](a,l)}this.refresh=function(){var a=new qq.Promise,r=function(c,f,h){i(c,f,h,a)},l=qq.extend({},t),s=new qq.SessionAjaxRequester(qq.extend(l,{onComplete:r}));return s.queryServer(),a}},qq.SessionAjaxRequester=function(e){var t,n={endpoint:null,customHeaders:{},params:{},cors:{expected:!1,sendCredentials:!1},onComplete:function(a,r,l){},log:function(a,r){}};qq.extend(n,e);function i(a,r,l){var s=null;if(r.responseText!=null)try{s=qq.parseJson(r.responseText)}catch(c){n.log("Problem parsing session response: "+c.message,"error"),l=!0}n.onComplete(s,!l,r)}t=qq.extend(this,new qq.AjaxRequester({acceptHeader:"application/json",validMethods:["GET"],method:"GET",endpointStore:{get:function(){return n.endpoint}},customHeaders:n.customHeaders,log:n.log,onComplete:i,cors:n.cors})),qq.extend(this,{queryServer:function(){var a=qq.extend({},n.params);n.log("Session query request."),t.initTransport("sessionRefresh").withParams(a).withCacheBuster().send()}})},qq.Scaler=function(e,t){var n=e.customResizer,i=e.sendOriginal,a=e.orient,r=e.defaultType,l=e.defaultQuality/100,s=e.failureText,c=e.includeExif,f=this._getSortedSizes(e.sizes);qq.extend(this,{enabled:qq.supportedFeatures.scaling&&f.length>0,getFileRecords:function(h,S,q){var o=this,u=[],p=q.blob?q.blob:q,m=new qq.Identify(p,t);return m.isPreviewableSync()?(qq.each(f,function(b,g){var d=o._determineOutputType({defaultType:r,requestedType:g.type,refType:p.type});u.push({uuid:qq.getUniqueId(),name:o._getName(S,{name:g.name,type:d,refType:p.type}),blob:new qq.BlobProxy(p,qq.bind(o._generateScaledImage,o,{customResizeFunction:n,maxSize:g.maxSize,orient:a,type:d,quality:l,failedText:s,includeExif:c,log:t}))})}),u.push({uuid:h,name:S,size:p.size,blob:i?p:null})):u.push({uuid:h,name:S,size:p.size,blob:p}),u},handleNewFile:function(h,S,q,o,u,p,m,b){var g=this;h.qqButtonId||h.blob&&h.blob.qqButtonId;var d=[],_=null,y=b.addFileToHandler,w=b.uploadData,x=b.paramsStore,F=qq.getUniqueId();qq.each(g.getFileRecords(q,S,h),function(C,D){var I=D.size,U;D.blob instanceof qq.BlobProxy&&(I=-1),U=w.addFile({uuid:D.uuid,name:D.name,size:I,batchId:p,proxyGroupId:F}),D.blob instanceof qq.BlobProxy?d.push(U):_=U,D.blob?(y(U,D.blob),u.push({id:U,file:D.blob})):w.setStatus(U,qq.status.REJECTED)}),_!==null&&(qq.each(d,function(C,D){var I={qqparentuuid:w.retrieve({id:_}).uuid,qqparentsize:w.retrieve({id:_}).size};I[m]=w.retrieve({id:D}).uuid,w.setParentId(D,_),x.addReadOnly(D,I)}),d.length&&function(){var C={};C[m]=w.retrieve({id:_}).uuid,x.addReadOnly(_,C)}())}})},qq.extend(qq.Scaler.prototype,{scaleImage:function(e,t,n){if(!qq.supportedFeatures.scaling)throw new qq.Error("Scaling is not supported in this browser!");var i=new qq.Promise,a=n.log,r=n.getFile(e),l=n.uploadData.retrieve({id:e}),s=l&&l.name,c=l&&l.uuid,f={customResizer:t.customResizer,sendOriginal:!1,orient:t.orient,defaultType:t.type||null,defaultQuality:t.quality,failedToScaleText:"Unable to scale",sizes:[{name:"",maxSize:t.maxSize}]},h=new qq.Scaler(f,a);return!qq.Scaler||!qq.supportedFeatures.imagePreviews||!r?(i.failure(),a("Could not generate requested scaled image for "+e+".  Scaling is either not possible in this browser, or the file could not be located.","error")):qq.bind(function(){var S=h.getFileRecords(c,s,r)[0];S&&S.blob instanceof qq.BlobProxy?S.blob.create().then(i.success,i.failure):(a(e+" is not a scalable image!","error"),i.failure())},this)(),i},_determineOutputType:function(e){var t=e.requestedType,n=e.defaultType,i=e.refType;return!n&&!t?i!=="image/jpeg"?"image/png":i:t&&qq.indexOf(Object.keys(qq.Identify.prototype.PREVIEWABLE_MIME_TYPES),t)>=0?t==="image/tiff"?qq.supportedFeatures.tiffPreviews?t:n:t:n},_getName:function(e,t){var n=e.lastIndexOf("."),i=t.type||"image/png",a=t.refType,r="",l=qq.getExtension(e),s="";return t.name&&t.name.trim().length&&(s=" ("+t.name+")"),n>=0?(r=e.substr(0,n),a!==i&&(l=i.split("/")[1]),r+=s+"."+l):r=e+s,r},_getSortedSizes:function(e){return e=qq.extend([],e),e.sort(function(t,n){return t.maxSize>n.maxSize?1:t.maxSize<n.maxSize?-1:0})},_generateScaledImage:function(e,t){var n=this,i=e.customResizeFunction,a=e.log,r=e.maxSize,l=e.orient,s=e.type,c=e.quality,f=e.failedText,h=e.includeExif&&t.type==="image/jpeg"&&s==="image/jpeg",S=new qq.Promise,q=new qq.ImageGenerator(a),o=document.createElement("canvas");return a("Attempting to generate scaled version for "+t.name),q.generate(t,o,{maxSize:r,orient:l,customResizeFunction:i}).then(function(){var u=o.toDataURL(s,c),p=function(){a("Success generating scaled version for "+t.name);var m=qq.dataUriToBlob(u);S.success(m)};h?n._insertExifHeader(t,u,a).then(function(m){u=m,p()},function(){a("Problem inserting EXIF header into scaled image.  Using scaled image w/out EXIF data.","error"),p()}):p()},function(){a("Failed attempt to generate scaled version for "+t.name,"error"),S.failure(f)}),S},_insertExifHeader:function(e,t,n){var i=new FileReader,a=new qq.Promise,r="";return i.onload=function(){r=i.result,a.success(qq.ExifRestorer.restore(r,t))},i.onerror=function(){n("Problem reading "+e.name+" during attempt to transfer EXIF data to scaled version.","error"),a.failure()},i.readAsDataURL(e),a},_dataUriToBlob:function(e){var t,n,i,a;return e.split(",")[0].indexOf("base64")>=0?t=atob(e.split(",")[1]):t=decodeURI(e.split(",")[1]),n=e.split(",")[0].split(":")[1].split(";")[0],i=new ArrayBuffer(t.length),a=new Uint8Array(i),qq.each(t,function(r,l){a[r]=l.charCodeAt(0)}),this._createBlob(i,n)},_createBlob:function(e,t){var n=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,i=n&&new n;return i?(i.append(e),i.getBlob(t)):new Blob([e],{type:t})}}),qq.ExifRestorer=function(){var e={};return e.KEY_STR="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",e.encode64=function(t){var n="",i,a,r="",l,s,c,f="",h=0;do i=t[h++],a=t[h++],r=t[h++],l=i>>2,s=(i&3)<<4|a>>4,c=(a&15)<<2|r>>6,f=r&63,isNaN(a)?c=f=64:isNaN(r)&&(f=64),n=n+this.KEY_STR.charAt(l)+this.KEY_STR.charAt(s)+this.KEY_STR.charAt(c)+this.KEY_STR.charAt(f),i=a=r="",l=s=c=f="";while(h<t.length);return n},e.restore=function(t,n){var i="data:image/jpeg;base64,";if(!t.match(i))return n;var a=this.decode64(t.replace(i,"")),r=this.slice2Segments(a),l=this.exifManipulation(n,r);return i+this.encode64(l)},e.exifManipulation=function(t,n){var i=this.getExifArray(n),a=this.insertExif(t,i),r=new Uint8Array(a);return r},e.getExifArray=function(t){for(var n,i=0;i<t.length;i++)if(n=t[i],n[0]==255&n[1]==225)return n;return[]},e.insertExif=function(t,n){var i=t.replace("data:image/jpeg;base64,",""),a=this.decode64(i),r=a.indexOf(255,3),l=a.slice(0,r),s=a.slice(r),c=l;return c=c.concat(n),c=c.concat(s),c},e.slice2Segments=function(t){for(var n=0,i=[];!(t[n]==255&t[n+1]==218);){if(t[n]==255&t[n+1]==216)n+=2;else{var a=t[n+2]*256+t[n+3],r=n+a+2,l=t.slice(n,r);i.push(l),n=r}if(n>t.length)break}return i},e.decode64=function(t){var n,i,a="",r,l,s,c="",f=0,h=[],S=/[^A-Za-z0-9\+\/\=]/g;if(S.exec(t))throw new Error("There were invalid base64 characters in the input text.  Valid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='");t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");do r=this.KEY_STR.indexOf(t.charAt(f++)),l=this.KEY_STR.indexOf(t.charAt(f++)),s=this.KEY_STR.indexOf(t.charAt(f++)),c=this.KEY_STR.indexOf(t.charAt(f++)),n=r<<2|l>>4,i=(l&15)<<4|s>>2,a=(s&3)<<6|c,h.push(n),s!=64&&h.push(i),c!=64&&h.push(a),n=i=a="",r=l=s=c="";while(f<t.length);return h},e}(),qq.TotalProgress=function(e,t){var n={},i=0,a=0,r=-1,l=-1,s=function(o,u){(o!==r||u!==l)&&e(o,u),r=o,l=u},c=function(o,u){var p=!0;return qq.each(o,function(m,b){if(qq.indexOf(u,b)>=0)return p=!1,!1}),p},f=function(o){q(o,-1,-1),delete n[o]},h=function(o,u,p){(u.length===0||c(u,p))&&(s(a,a),this.reset())},S=function(o){var u=t(o);u>0&&(q(o,0,u),n[o]={loaded:0,total:u})},q=function(o,u,p){var m=n[o]?n[o].loaded:0,b=n[o]?n[o].total:0;u===-1&&p===-1?(i-=m,a-=b):(u&&(i+=u-m),p&&(a+=p-b)),s(i,a)};qq.extend(this,{onAllComplete:h,onStatusChange:function(o,u,p){p===qq.status.CANCELED||p===qq.status.REJECTED?f(o):p===qq.status.SUBMITTING&&S(o)},onIndividualProgress:function(o,u,p){q(o,u,p),n[o]={loaded:u,total:p}},onNewSize:function(o){S(o)},reset:function(){n={},i=0,a=0}})},qq.PasteSupport=function(e){var t,n;t={targetElement:null,callbacks:{log:function(l,s){},pasteReceived:function(l){}}};function i(l){return l.type&&l.type.indexOf("image/")===0}function a(){n=qq(t.targetElement).attach("paste",function(l){var s=l.clipboardData;s&&qq.each(s.items,function(c,f){if(i(f)){var h=f.getAsFile();t.callbacks.pasteReceived(h)}})})}function r(){n&&n()}qq.extend(t,e),a(),qq.extend(this,{reset:function(){r()}})},qq.FormSupport=function(e,t,n){var i=this,a=e.interceptSubmit,r=e.element,l=e.autoUpload;qq.extend(this,{newEndpoint:null,newAutoUpload:l,attachedToForm:!1,getFormInputsAsObject:function(){return r==null?null:i._form2Obj(r)}});function s(S){S.getAttribute("action")&&(i.newEndpoint=S.getAttribute("action"))}function c(S,q){if(S.checkValidity&&!S.checkValidity())n("Form did not pass validation checks - will not upload.","error"),q();else return!0}function f(S){var q=S.submit;qq(S).attach("submit",function(o){o=o||window.event,o.preventDefault?o.preventDefault():o.returnValue=!1,c(S,q)&&t()}),S.submit=function(){c(S,q)&&t()}}function h(S){return S&&(qq.isString(S)&&(S=document.getElementById(S)),S&&(n("Attaching to form element."),s(S),a&&f(S))),S}r=h(r),this.attachedToForm=!!r},qq.extend(qq.FormSupport.prototype,{_form2Obj:function(e){var t={},n=function(l){var s=["button","image","reset","submit"];return qq.indexOf(s,l.toLowerCase())<0},i=function(l){return qq.indexOf(["checkbox","radio"],l.toLowerCase())>=0},a=function(l){return i(l.type)&&!l.checked?!0:l.disabled&&l.type.toLowerCase()!=="hidden"},r=function(l){var s=null;return qq.each(qq(l).children(),function(c,f){if(f.tagName.toLowerCase()==="option"&&f.selected)return s=f.value,!1}),s};return qq.each(e.elements,function(l,s){if((qq.isInput(s,!0)||s.tagName.toLowerCase()==="textarea")&&n(s.type)&&!a(s))t[s.name]=s.value;else if(s.tagName.toLowerCase()==="select"&&!a(s)){var c=r(s);c!==null&&(t[s.name]=c)}}),t}}),qq.traditional=qq.traditional||{},qq.traditional.FormUploadHandler=function(e,t){var n=this,i=t.getName,a=t.getUuid,r=t.log;function l(c,f){var h,S,q;try{S=f.contentDocument||f.contentWindow.document,q=S.body.innerHTML,r("converting iframe's innerHTML to JSON"),r("innerHTML = "+q),q&&q.match(/^<pre/i)&&(q=S.body.firstChild.firstChild.nodeValue),h=n._parseJsonResponse(q)}catch(o){r("Error when attempting to parse form upload response ("+o.message+")","error"),h={success:!1}}return h}function s(c,f){var h=e.paramsStore.get(c),S=e.method.toLowerCase()==="get"?"GET":"POST",q=e.endpointStore.get(c),o=i(c);return h[e.uuidName]=a(c),h[e.filenameParam]=o,n._initFormForUpload({method:S,endpoint:q,params:h,paramsInBody:e.paramsInBody,targetName:f.name})}this.uploadFile=function(c){var f=n.getInput(c),h=n._createIframe(c),S=new qq.Promise,q;return q=s(c,h),q.appendChild(f),n._attachLoadEvent(h,function(o){r("iframe loaded");var u=o||l(c,h);n._detachLoadEvent(c),e.cors.expected||qq(h).remove(),u.success?S.success(u):S.failure(u)}),r("Sending upload request for "+c),q.submit(),qq(q).remove(),S},qq.extend(this,new qq.FormUploadHandler({options:{isCors:e.cors.expected,inputName:e.inputName},proxy:{onCancel:e.onCancel,getName:i,getUuid:a,log:r}}))},qq.traditional=qq.traditional||{},qq.traditional.XhrUploadHandler=function(e,t){var n=this,i=t.getName,a=t.getSize,r=t.getUuid,l=t.log,s=e.forceMultipart||e.paramsInBody,c=function(g,d,_){var y=a(g),w=i(g);e.omitDefaultParams||(d[e.chunking.paramNames.partIndex]=_.part,d[e.chunking.paramNames.partByteOffset]=_.start,d[e.chunking.paramNames.chunkSize]=_.size,d[e.chunking.paramNames.totalParts]=_.count,d[e.totalFileSizeName]=y),s&&!e.omitDefaultParams&&(d[e.filenameParam]=w)},f=new qq.traditional.AllChunksDoneAjaxRequester({cors:e.cors,endpoint:e.chunking.success.endpoint,headers:e.chunking.success.headers,jsonPayload:e.chunking.success.jsonPayload,log:l,method:e.chunking.success.method,params:e.chunking.success.params}),h=function(g,d){var _=new qq.Promise;return d.onreadystatechange=function(){if(d.readyState===4){var y=o(g,d);y.success?_.success(y.response,d):_.failure(y.response,d)}},_},S=function(g){var d=e.paramsStore.get(g),_=i(g),y=a(g);return d[e.uuidName]=r(g),d[e.filenameParam]=_,d[e.totalFileSizeName]=y,d[e.chunking.paramNames.totalParts]=n._getTotalChunks(g),d},q=function(g,d){return qq.indexOf([200,201,202,203,204],g.status)<0||e.requireSuccessJson&&!d.success||d.reset},o=function(g,d){var _;return l("xhr - server response received for "+g),l("responseText = "+d.responseText),_=u(!0,d),{success:!q(d,_),response:_}},u=function(g,d){var _={};try{l(qq.format("Received response status {} with body: {}",d.status,d.responseText)),_=qq.parseJson(d.responseText)}catch(y){g&&e.requireSuccessJson&&l("Error when attempting to parse xhr response text ("+y.message+")","error")}return _},p=function(g){var d=new qq.Promise;return f.complete(g,n._createXhr(g),S(g),e.customHeaders.get(g)).then(function(_){d.success(u(!1,_),_)},function(_){d.failure(u(!1,_),_)}),d},m=function(g){var d=g.fileOrBlob,_=g.id,y=g.xhr,w=g.xhrOverrides||{},x=g.customParams||{},F=g.params||{},C=w.params||{},D,I=s?new FormData:null,U=w.method||e.method,A=w.endpoint||e.endpointStore.get(_),B=i(_),j=a(_);return e.omitDefaultParams?(D=qq.extend({},x),qq.extend(D,C)):(D=qq.extend({},x),qq.extend(D,C),qq.extend(D,F),D[e.uuidName]=r(_),D[e.filenameParam]=B,s?D[e.totalFileSizeName]=j:e.paramsInBody||(D[e.inputName]=B)),e.paramsInBody||(A=qq.obj2url(D,A)),y.open(U,A,!0),e.cors.expected&&e.cors.sendCredentials&&(y.withCredentials=!0),s?(e.paramsInBody&&qq.obj2FormData(D,I),I.append(e.inputName,d),I):d},b=function(g){var d=g.headerOverrides,_=g.id,y=g.xhr;if(d)qq.each(d,function(F,C){y.setRequestHeader(F,C)});else{var w=e.customHeaders.get(_),x=n.getFile(_);y.setRequestHeader("Accept","application/json"),y.setRequestHeader("X-Requested-With","XMLHttpRequest"),y.setRequestHeader("Cache-Control","no-cache"),s||(y.setRequestHeader("Content-Type","application/octet-stream"),y.setRequestHeader("X-Mime-Type",x.type)),qq.each(w,function(F,C){y.setRequestHeader(F,C)})}};qq.extend(this,{uploadChunk:function(g){var d=g.id,_=g.chunkIdx,y=g.overrides||{},w=g.resuming,x=n._getChunkData(d,_),F=n._createXhr(d,_),C,D,I,U={};return C=h(d,F),n._registerProgressHandler(d,_,x.size),I=e.paramsStore.get(d),c(d,U,x),w&&(U[e.resume.paramNames.resuming]=!0),D=m({fileOrBlob:x.blob,id:d,customParams:I,params:U,xhr:F,xhrOverrides:y}),b({headerOverrides:y.headers,id:d,xhr:F}),F.send(D),C},uploadFile:function(g){var d=n.getFile(g),_,y,w,x;return y=n._createXhr(g),n._registerProgressHandler(g),_=h(g,y),w=e.paramsStore.get(g),x=m({fileOrBlob:d,id:g,customParams:w,xhr:y}),b({id:g,xhr:y}),y.send(x),_}}),qq.extend(this,new qq.XhrUploadHandler({options:qq.extend({namespace:"traditional"},e),proxy:qq.extend({getEndpoint:e.endpointStore.get},t)})),qq.override(this,function(g){return{finalizeChunks:function(d){return t.onFinalizing(d),e.chunking.success.endpoint?p(d):g.finalizeChunks(d,qq.bind(u,this,!0))}}})},qq.traditional.AllChunksDoneAjaxRequester=function(e){var t,n={cors:{allowXdr:!1,expected:!1,sendCredentials:!1},endpoint:null,log:function(r,l){},method:"POST"},i={},a={get:function(r){return qq.isFunction(n.endpoint)?n.endpoint(r):n.endpoint}};qq.extend(n,e),t=qq.extend(this,new qq.AjaxRequester({acceptHeader:"application/json",contentType:n.jsonPayload?"application/json":"application/x-www-form-urlencoded",validMethods:[n.method],method:n.method,endpointStore:a,allowXRequestedWithAndCacheControl:!1,cors:n.cors,log:n.log,onComplete:function(r,l,s){var c=i[r];delete i[r],s?c.failure(l):c.success(l)}})),qq.extend(this,{complete:function(r,l,s,c){var f=new qq.Promise;return n.log("Submitting All Chunks Done request for "+r),i[r]=f,t.initTransport(r).withParams(n.params(r)||s).withHeaders(n.headers(r)||c).send(l),f}})},qq.DragAndDrop=function(e){var t,n="qq-hidezones",i="qq-hide-dropzone",a=[],r=[],l=new qq.DisposeSupport;t={dropZoneElements:[],allowMultipleItems:!0,classes:{dropActive:null},callbacks:new qq.DragAndDrop.callbacks},qq.extend(t,e,!0);function s(m,b){var g=Array.prototype.slice.call(m);t.callbacks.dropLog("Grabbed "+m.length+" dropped files."),b.dropDisabled(!1),t.callbacks.processingDroppedFilesComplete(g,b.getElement())}function c(m){var b=new qq.Promise;return m.isFile?m.file(function(g){g.qqPath=f(m),r.push(g),b.success()},function(g){t.callbacks.dropLog("Problem parsing '"+m.fullPath+"'.  FileError code "+g.code+".","error"),b.failure()}):m.isDirectory&&h(m).then(function(d){var _=d.length;qq.each(d,function(y,w){c(w).done(function(){_-=1,_===0&&b.success()})}),d.length||b.success()},function(d){t.callbacks.dropLog("Problem parsing '"+m.fullPath+"'.  FileError code "+d.code+".","error"),b.failure()}),b}function f(m){var b=m.name,g=m.fullPath,d=g.lastIndexOf(b);return g=g.substr(0,d),g.charAt(0)==="/"&&(g=g.substr(1)),g}function h(m,b,g,d){var _=d||new qq.Promise,y=b||m.createReader();return y.readEntries(function(x){var F=g?g.concat(x):x;x.length?setTimeout(function(){h(m,y,F,_)},0):_.success(F)},_.failure),_}function S(m,b){var g=[],d=new qq.Promise;return t.callbacks.processingDroppedFiles(),b.dropDisabled(!0),m.files.length>1&&!t.allowMultipleItems?(t.callbacks.processingDroppedFilesComplete([]),t.callbacks.dropError("tooManyFilesError",""),b.dropDisabled(!1),d.failure()):(r=[],qq.isFolderDropSupported(m)?qq.each(m.items,function(_,y){var w=y.webkitGetAsEntry();w&&(w.isFile?r.push(y.getAsFile()):g.push(c(w).done(function(){g.pop(),g.length===0&&d.success()})))}):r=m.files,g.length===0&&d.success()),d}function q(m){var b=new qq.UploadDropZone({HIDE_ZONES_EVENT_NAME:n,element:m,onEnter:function(g){qq(m).addClass(t.classes.dropActive),g.stopPropagation()},onLeaveNotDescendants:function(g){qq(m).removeClass(t.classes.dropActive)},onDrop:function(g){S(g.dataTransfer,b).then(function(){s(r,b)},function(){t.callbacks.dropLog("Drop event DataTransfer parsing failed.  No files will be uploaded.","error")})}});return l.addDisposer(function(){b.dispose()}),qq(m).hasAttribute(i)&&qq(m).hide(),a.push(b),b}function o(m){var b;return qq.each(m.dataTransfer.types,function(g,d){if(d==="Files")return b=!0,!1}),b}function u(m){return qq.safari()?m.x<0||m.y<0:m.x===0&&m.y===0}function p(){var m=t.dropZoneElements,b=function(){setTimeout(function(){qq.each(m,function(g,d){qq(d).hasAttribute(i)&&qq(d).hide(),qq(d).removeClass(t.classes.dropActive)})},10)};qq.each(m,function(g,d){var _=q(d);m.length&&qq.supportedFeatures.fileDrop&&l.attach(document,"dragenter",function(y){!_.dropDisabled()&&o(y)&&qq.each(m,function(w,x){x instanceof HTMLElement&&qq(x).hasAttribute(i)&&qq(x).css({display:"block"})})})}),l.attach(document,"dragleave",function(g){u(g)&&b()}),l.attach(qq(document).children()[0],"mouseenter",function(g){b()}),l.attach(document,"drop",function(g){o(g)&&(g.preventDefault(),b())}),l.attach(document,n,b)}p(),qq.extend(this,{setupExtraDropzone:function(m){t.dropZoneElements.push(m),q(m)},removeDropzone:function(m){var b,g=t.dropZoneElements;for(b in g)if(g[b]===m)return g.splice(b,1)},dispose:function(){l.dispose(),qq.each(a,function(m,b){b.dispose()})}}),this._testing={},this._testing.extractDirectoryPath=f},qq.DragAndDrop.callbacks=function(){return{processingDroppedFiles:function(){},processingDroppedFilesComplete:function(e,t){},dropError:function(e,t){qq.log("Drag & drop error code '"+e+" with these specifics: '"+t+"'","error")},dropLog:function(e,t){qq.log(e,t)}}},qq.UploadDropZone=function(e){var t=new qq.DisposeSupport,n,i,a,r;n={element:null,onEnter:function(q){},onLeave:function(q){},onLeaveNotDescendants:function(q){},onDrop:function(q){}},qq.extend(n,e),i=n.element;function l(){return qq.safari()||qq.firefox()&&qq.windows()}function s(q){r||(l?t.attach(document,"dragover",function(o){o.preventDefault()}):t.attach(document,"dragover",function(o){o.dataTransfer&&(o.dataTransfer.dropEffect="none",o.preventDefault())}),r=!0)}function c(q){if(!qq.supportedFeatures.fileDrop)return!1;var o,u=q.dataTransfer,p=qq.safari();return o=qq.ie()&&qq.supportedFeatures.fileDrop?!0:u.effectAllowed!=="none",u&&o&&(u.files&&u.files.length||!p&&u.types.contains&&u.types.contains("Files")||u.types.includes&&u.types.includes("Files"))}function f(q){return q!==void 0&&(a=q),a}function h(){var q;function o(){q=document.createEvent("Event"),q.initEvent(n.HIDE_ZONES_EVENT_NAME,!0,!0)}if(window.CustomEvent)try{q=new CustomEvent(n.HIDE_ZONES_EVENT_NAME)}catch{o()}else o();document.dispatchEvent(q)}function S(){t.attach(i,"dragover",function(q){if(c(q)){var o=qq.ie()&&qq.supportedFeatures.fileDrop?null:q.dataTransfer.effectAllowed;o==="move"||o==="linkMove"?q.dataTransfer.dropEffect="move":q.dataTransfer.dropEffect="copy",q.stopPropagation(),q.preventDefault()}}),t.attach(i,"dragenter",function(q){if(!f()){if(!c(q))return;n.onEnter(q)}}),t.attach(i,"dragleave",function(q){if(c(q)){n.onLeave(q);var o=document.elementFromPoint(q.clientX,q.clientY);qq(this).contains(o)||n.onLeaveNotDescendants(q)}}),t.attach(i,"drop",function(q){if(!f()){if(!c(q))return;q.preventDefault(),q.stopPropagation(),n.onDrop(q),h()}})}s(),S(),qq.extend(this,{dropDisabled:function(q){return f(q)},dispose:function(){t.dispose()},getElement:function(){return i}}),this._testing={},this._testing.isValidFileDrag=c},function(){qq.uiPublicApi={addInitialFiles:function(e){this._parent.prototype.addInitialFiles.apply(this,arguments),this._templating.addCacheToDom()},clearStoredFiles:function(){this._parent.prototype.clearStoredFiles.apply(this,arguments),this._templating.clearFiles()},addExtraDropzone:function(e){this._dnd&&this._dnd.setupExtraDropzone(e)},removeExtraDropzone:function(e){if(this._dnd)return this._dnd.removeDropzone(e)},getItemByFileId:function(e){if(!this._templating.isHiddenForever(e))return this._templating.getFileContainer(e)},reset:function(){this._parent.prototype.reset.apply(this,arguments),this._templating.reset(),!this._options.button&&this._templating.getButton()&&(this._defaultButtonId=this._createUploadButton({element:this._templating.getButton(),title:this._options.text.fileInputTitle}).getButtonId()),this._dnd&&(this._dnd.dispose(),this._dnd=this._setupDragAndDrop()),this._totalFilesInBatch=0,this._filesInBatchAddedToUi=0,this._setupClickAndEditEventHandlers()},setName:function(e,t){var n=this._options.formatFileName(t);this._parent.prototype.setName.apply(this,arguments),this._templating.updateFilename(e,n)},pauseUpload:function(e){var t=this._parent.prototype.pauseUpload.apply(this,arguments);return t&&this._templating.uploadPaused(e),t},continueUpload:function(e){var t=this._parent.prototype.continueUpload.apply(this,arguments);return t&&this._templating.uploadContinued(e),t},getId:function(e){return this._templating.getFileId(e)},getDropTarget:function(e){var t=this.getFile(e);return t.qqDropTarget}},qq.uiPrivateApi={_getButton:function(e){var t=this._parent.prototype._getButton.apply(this,arguments);return t||e===this._defaultButtonId&&(t=this._templating.getButton()),t},_removeFileItem:function(e){this._templating.removeFile(e)},_setupClickAndEditEventHandlers:function(){this._fileButtonsClickHandler=qq.FileButtonsClickHandler&&this._bindFileButtonsClickEvent(),this._focusinEventSupported=!qq.firefox(),this._isEditFilenameEnabled()&&(this._filenameClickHandler=this._bindFilenameClickEvent(),this._filenameInputFocusInHandler=this._bindFilenameInputFocusInEvent(),this._filenameInputFocusHandler=this._bindFilenameInputFocusEvent())},_setupDragAndDrop:function(){var e=this,t=this._options.dragAndDrop.extraDropzones,n=this._templating,i=n.getDropZone();return i&&t.push(i),new qq.DragAndDrop({dropZoneElements:t,allowMultipleItems:this._options.multiple,classes:{dropActive:this._options.classes.dropActive},callbacks:{processingDroppedFiles:function(){n.showDropProcessing()},processingDroppedFilesComplete:function(a,r){n.hideDropProcessing(),qq.each(a,function(l,s){s.qqDropTarget=r}),a.length&&e.addFiles(a,null,null)},dropError:function(a,r){e._itemError(a,r)},dropLog:function(a,r){e.log(a,r)}}})},_bindFileButtonsClickEvent:function(){var e=this;return new qq.FileButtonsClickHandler({templating:this._templating,log:function(t,n){e.log(t,n)},onDeleteFile:function(t){e.deleteFile(t)},onCancel:function(t){e.cancel(t)},onRetry:function(t){e.retry(t)},onPause:function(t){e.pauseUpload(t)},onContinue:function(t){e.continueUpload(t)},onGetName:function(t){return e.getName(t)}})},_isEditFilenameEnabled:function(){return this._templating.isEditFilenamePossible()&&!this._options.autoUpload&&qq.FilenameClickHandler&&qq.FilenameInputFocusHandler&&qq.FilenameInputFocusHandler},_filenameEditHandler:function(){var e=this,t=this._templating;return{templating:t,log:function(n,i){e.log(n,i)},onGetUploadStatus:function(n){return e.getUploads({id:n}).status},onGetName:function(n){return e.getName(n)},onSetName:function(n,i){e.setName(n,i)},onEditingStatusChange:function(n,i){var a=qq(t.getEditInput(n)),r=qq(t.getFileContainer(n));i?(a.addClass("qq-editing"),t.hideFilename(n),t.hideEditIcon(n)):(a.removeClass("qq-editing"),t.showFilename(n),t.showEditIcon(n)),r.addClass("qq-temp").removeClass("qq-temp")}}},_onUploadStatusChange:function(e,t,n){this._parent.prototype._onUploadStatusChange.apply(this,arguments),this._isEditFilenameEnabled()&&this._templating.getFileContainer(e)&&n!==qq.status.SUBMITTED&&(this._templating.markFilenameEditable(e),this._templating.hideEditIcon(e)),t===qq.status.UPLOAD_RETRYING&&n===qq.status.UPLOADING?(this._templating.hideRetry(e),this._templating.setStatusText(e),qq(this._templating.getFileContainer(e)).removeClass(this._classes.retrying)):n===qq.status.UPLOAD_FAILED&&this._templating.hidePause(e)},_bindFilenameInputFocusInEvent:function(){var e=qq.extend({},this._filenameEditHandler());return new qq.FilenameInputFocusInHandler(e)},_bindFilenameInputFocusEvent:function(){var e=qq.extend({},this._filenameEditHandler());return new qq.FilenameInputFocusHandler(e)},_bindFilenameClickEvent:function(){var e=qq.extend({},this._filenameEditHandler());return new qq.FilenameClickHandler(e)},_storeForLater:function(e){this._parent.prototype._storeForLater.apply(this,arguments),this._templating.hideSpinner(e)},_onAllComplete:function(e,t){this._parent.prototype._onAllComplete.apply(this,arguments),this._templating.resetTotalProgress()},_onSubmit:function(e,t){var n=this.getFile(e);n&&n.qqPath&&this._options.dragAndDrop.reportDirectoryPaths&&this._paramsStore.addReadOnly(e,{qqpath:n.qqPath}),this._parent.prototype._onSubmit.apply(this,arguments),this._addToList(e,t)},_onSubmitted:function(e){this._isEditFilenameEnabled()&&(this._templating.markFilenameEditable(e),this._templating.showEditIcon(e),this._focusinEventSupported||this._filenameInputFocusHandler.addHandler(this._templating.getEditInput(e)))},_onProgress:function(e,t,n,i){this._parent.prototype._onProgress.apply(this,arguments),this._templating.updateProgress(e,n,i),i===0||Math.round(n/i*100)===100?(this._templating.hideCancel(e),this._templating.hidePause(e),this._templating.hideProgress(e),this._templating.setStatusText(e,this._options.text.waitingForResponse),this._displayFileSize(e)):this._displayFileSize(e,n,i)},_onTotalProgress:function(e,t){this._parent.prototype._onTotalProgress.apply(this,arguments),this._templating.updateTotalProgress(e,t)},_onComplete:function(e,t,n,i){var a=this._parent.prototype._onComplete.apply(this,arguments),r=this._templating,l=r.getFileContainer(e),s=this;function c(f){l&&(r.setStatusText(e),qq(l).removeClass(s._classes.retrying),r.hideProgress(e),s.getUploads({id:e}).status!==qq.status.UPLOAD_FAILED&&r.hideCancel(e),r.hideSpinner(e),f.success?s._markFileAsSuccessful(e):(qq(l).addClass(s._classes.fail),r.showCancel(e),r.isRetryPossible()&&!s._preventRetries[e]&&(qq(l).addClass(s._classes.retryable),r.showRetry(e)),s._controlFailureTextDisplay(e,f)))}return a instanceof qq.Promise?a.done(function(f){c(f)}):c(n),a},_markFileAsSuccessful:function(e){var t=this._templating;this._isDeletePossible()&&t.showDeleteButton(e),qq(t.getFileContainer(e)).addClass(this._classes.success),this._maybeUpdateThumbnail(e)},_onUploadPrep:function(e){this._parent.prototype._onUploadPrep.apply(this,arguments),this._templating.showSpinner(e)},_onUpload:function(e,t){var n=this._parent.prototype._onUpload.apply(this,arguments);return this._templating.showSpinner(e),n},_onUploadChunk:function(e,t){this._parent.prototype._onUploadChunk.apply(this,arguments),t.partIndex>0&&this._handler.isResumable(e)&&this._templating.allowPause(e)},_onCancel:function(e,t){this._parent.prototype._onCancel.apply(this,arguments),this._removeFileItem(e),this._getNotFinished()===0&&this._templating.resetTotalProgress()},_onBeforeAutoRetry:function(e){var t,n,i;this._parent.prototype._onBeforeAutoRetry.apply(this,arguments),this._showCancelLink(e),this._options.retry.showAutoRetryNote&&(t=this._autoRetries[e],n=this._options.retry.maxAutoAttempts,i=this._options.retry.autoRetryNote.replace(/\{retryNum\}/g,t),i=i.replace(/\{maxAuto\}/g,n),this._templating.setStatusText(e,i),qq(this._templating.getFileContainer(e)).addClass(this._classes.retrying))},_onBeforeManualRetry:function(e){return this._parent.prototype._onBeforeManualRetry.apply(this,arguments)?(this._templating.resetProgress(e),qq(this._templating.getFileContainer(e)).removeClass(this._classes.fail),this._templating.setStatusText(e),this._templating.showSpinner(e),this._showCancelLink(e),!0):(qq(this._templating.getFileContainer(e)).addClass(this._classes.retryable),this._templating.showRetry(e),!1)},_onSubmitDelete:function(e){var t=qq.bind(this._onSubmitDeleteSuccess,this);this._parent.prototype._onSubmitDelete.call(this,e,t)},_onSubmitDeleteSuccess:function(e,t,n){this._options.deleteFile.forceConfirm?this._showDeleteConfirm.apply(this,arguments):this._sendDeleteRequest.apply(this,arguments)},_onDeleteComplete:function(e,t,n){this._parent.prototype._onDeleteComplete.apply(this,arguments),this._templating.hideSpinner(e),n?(this._templating.setStatusText(e,this._options.deleteFile.deletingFailedText),this._templating.showDeleteButton(e)):this._removeFileItem(e)},_sendDeleteRequest:function(e,t,n){this._templating.hideDeleteButton(e),this._templating.showSpinner(e),this._templating.setStatusText(e,this._options.deleteFile.deletingStatusText),this._deleteHandler.sendDelete.apply(this,arguments)},_showDeleteConfirm:function(e,r,n){var i=this.getName(e),a=this._options.deleteFile.confirmMessage.replace(/\{filename\}/g,i),r=this.getUuid(e),l=arguments,s=this,c;c=this._options.showConfirm(a),qq.isGenericPromise(c)?c.then(function(){s._sendDeleteRequest.apply(s,l)}):c!==!1&&s._sendDeleteRequest.apply(s,l)},_addToList:function(e,t,n){var i,a=0,r=this._handler.isProxied(e)&&this._options.scaling.hideScaled,l;this._options.display.prependFiles&&(this._totalFilesInBatch>1&&this._filesInBatchAddedToUi>0&&(a=this._filesInBatchAddedToUi-1),i={index:a}),n||(this._options.disableCancelForFormUploads&&!qq.supportedFeatures.ajaxUploading&&this._templating.disableCancel(),this._options.multiple||(l=this.getUploads({id:e}),this._handledProxyGroup=this._handledProxyGroup||l.proxyGroupId,(l.proxyGroupId!==this._handledProxyGroup||!l.proxyGroupId)&&(this._handler.cancelAll(),this._clearList(),this._handledProxyGroup=null))),n?(this._templating.addFileToCache(e,this._options.formatFileName(t),i,r),this._templating.updateThumbnail(e,this._thumbnailUrls[e],!0,this._options.thumbnails.customResizer)):(this._templating.addFile(e,this._options.formatFileName(t),i,r),this._templating.generatePreview(e,this.getFile(e),this._options.thumbnails.customResizer)),this._filesInBatchAddedToUi+=1,(n||this._options.display.fileSizeOnSubmit&&qq.supportedFeatures.ajaxUploading)&&this._displayFileSize(e)},_clearList:function(){this._templating.clearFiles(),this.clearStoredFiles()},_displayFileSize:function(e,t,n){var i=this.getSize(e),a=this._formatSize(i);i>=0&&(t!==void 0&&n!==void 0&&(a=this._formatProgress(t,n)),this._templating.updateSize(e,a))},_formatProgress:function(e,t){var n=this._options.text.formatProgress;function i(a,r){n=n.replace(a,r)}return i("{percent}",Math.round(e/t*100)),i("{total_size}",this._formatSize(t)),n},_controlFailureTextDisplay:function(e,t){var n,i,a;n=this._options.failedUploadTextDisplay.mode,i=this._options.failedUploadTextDisplay.responseProperty,n==="custom"?(a=t[i],a||(a=this._options.text.failUpload),this._templating.setStatusText(e,a),this._options.failedUploadTextDisplay.enableTooltip&&this._showTooltip(e,a)):n==="default"?this._templating.setStatusText(e,this._options.text.failUpload):n!=="none"&&this.log("failedUploadTextDisplay.mode value of '"+n+"' is not valid","warn")},_showTooltip:function(e,t){this._templating.getFileContainer(e).title=t},_showCancelLink:function(e){(!this._options.disableCancelForFormUploads||qq.supportedFeatures.ajaxUploading)&&this._templating.showCancel(e)},_itemError:function(e,t,n){var i=this._parent.prototype._itemError.apply(this,arguments);this._options.showMessage(i)},_batchError:function(e){this._parent.prototype._batchError.apply(this,arguments),this._options.showMessage(e)},_setupPastePrompt:function(){var e=this;this._options.callbacks.onPasteReceived=function(){var t=e._options.paste.namePromptMessage,n=e._options.paste.defaultName;return e._options.showPrompt(t,n)}},_fileOrBlobRejected:function(e,t){this._totalFilesInBatch-=1,this._parent.prototype._fileOrBlobRejected.apply(this,arguments)},_prepareItemsForUpload:function(e,t,n){this._totalFilesInBatch=e.length,this._filesInBatchAddedToUi=0,this._parent.prototype._prepareItemsForUpload.apply(this,arguments)},_maybeUpdateThumbnail:function(e){var t=this._thumbnailUrls[e],n=this.getUploads({id:e}).status;n!==qq.status.DELETED&&(t||this._options.thumbnails.placeholders.waitUntilResponse||!qq.supportedFeatures.imagePreviews)&&this._templating.updateThumbnail(e,t,this._options.thumbnails.customResizer)},_addCannedFile:function(e){var t=this._parent.prototype._addCannedFile.apply(this,arguments);return this._addToList(t,this.getName(t),!0),this._templating.hideSpinner(t),this._templating.hideCancel(t),this._markFileAsSuccessful(t),t},_setSize:function(e,t){this._parent.prototype._setSize.apply(this,arguments),this._templating.updateSize(e,this._formatSize(t))},_sessionRequestComplete:function(){this._templating.addCacheToDom(),this._parent.prototype._sessionRequestComplete.apply(this,arguments)}}}(),qq.FineUploader=function(e,t){var n=this;this._parent=t?qq[t].FineUploaderBasic:qq.FineUploaderBasic,this._parent.apply(this,arguments),qq.extend(this._options,{element:null,button:null,listElement:null,dragAndDrop:{extraDropzones:[],reportDirectoryPaths:!1},text:{formatProgress:"{percent}% of {total_size}",failUpload:"Upload failed",waitingForResponse:"Processing...",paused:"Paused"},template:"qq-template",classes:{retrying:"qq-upload-retrying",retryable:"qq-upload-retryable",success:"qq-upload-success",fail:"qq-upload-fail",editable:"qq-editable",hide:"qq-hide",dropActive:"qq-upload-drop-area-active"},failedUploadTextDisplay:{mode:"default",responseProperty:"error",enableTooltip:!0},messages:{tooManyFilesError:"You may only drop one file",unsupportedBrowser:"Unrecoverable error - this browser does not permit file uploading of any kind."},retry:{showAutoRetryNote:!0,autoRetryNote:"Retrying {retryNum}/{maxAuto}..."},deleteFile:{forceConfirm:!1,confirmMessage:"Are you sure you want to delete {filename}?",deletingStatusText:"Deleting...",deletingFailedText:"Delete failed"},display:{fileSizeOnSubmit:!1,prependFiles:!1},paste:{promptForName:!1,namePromptMessage:"Please name this image"},thumbnails:{customResizer:null,maxCount:0,placeholders:{waitUntilResponse:!1,notAvailablePath:null,waitingPath:null},timeBetweenThumbs:750},scaling:{hideScaled:!1},showMessage:function(i){if(n._templating.hasDialog("alert"))return n._templating.showDialog("alert",i);setTimeout(function(){window.alert(i)},0)},showConfirm:function(i){return n._templating.hasDialog("confirm")?n._templating.showDialog("confirm",i):window.confirm(i)},showPrompt:function(i,a){return n._templating.hasDialog("prompt")?n._templating.showDialog("prompt",i,a):window.prompt(i,a)}},!0),qq.extend(this._options,e,!0),this._templating=new qq.Templating({log:qq.bind(this.log,this),templateIdOrEl:this._options.template,containerEl:this._options.element,fileContainerEl:this._options.listElement,button:this._options.button,imageGenerator:this._imageGenerator,classes:{hide:this._options.classes.hide,editable:this._options.classes.editable},limits:{maxThumbs:this._options.thumbnails.maxCount,timeBetweenThumbs:this._options.thumbnails.timeBetweenThumbs},placeholders:{waitUntilUpdate:this._options.thumbnails.placeholders.waitUntilResponse,thumbnailNotAvailable:this._options.thumbnails.placeholders.notAvailablePath,waitingForThumbnail:this._options.thumbnails.placeholders.waitingPath},text:this._options.text}),this._options.workarounds.ios8SafariUploads&&qq.ios800()&&qq.iosSafari()?this._templating.renderFailure(this._options.messages.unsupportedBrowserIos8Safari):!qq.supportedFeatures.uploading||this._options.cors.expected&&!qq.supportedFeatures.uploadCors?this._templating.renderFailure(this._options.messages.unsupportedBrowser):(this._wrapCallbacks(),this._templating.render(),this._classes=this._options.classes,!this._options.button&&this._templating.getButton()&&(this._defaultButtonId=this._createUploadButton({element:this._templating.getButton(),title:this._options.text.fileInputTitle}).getButtonId()),this._setupClickAndEditEventHandlers(),qq.DragAndDrop&&qq.supportedFeatures.fileDrop&&(this._dnd=this._setupDragAndDrop()),this._options.paste.targetElement&&this._options.paste.promptForName&&(qq.PasteSupport?this._setupPastePrompt():this.log("Paste support module not found.","error")),this._totalFilesInBatch=0,this._filesInBatchAddedToUi=0)},qq.extend(qq.FineUploader.prototype,qq.basePublicApi),qq.extend(qq.FineUploader.prototype,qq.basePrivateApi),qq.extend(qq.FineUploader.prototype,qq.uiPublicApi),qq.extend(qq.FineUploader.prototype,qq.uiPrivateApi),qq.Templating=function(e){var t="qq-file-id",n="qq-file-id-",i="qq-max-size",a="qq-server-scale",r="qq-hide-dropzone",l="qq-drop-area-text",s="qq-in-progress",c="qq-hidden-forever",f={content:document.createDocumentFragment(),map:{}},h=!1,S=0,q=!1,o=[],u=-1,p={log:null,limits:{maxThumbs:0,timeBetweenThumbs:750},templateIdOrEl:"qq-template",containerEl:null,fileContainerEl:null,button:null,imageGenerator:null,classes:{hide:"qq-hide",editable:"qq-editable"},placeholders:{waitUntilUpdate:!1,thumbnailNotAvailable:null,waitingForThumbnail:null},text:{paused:"Paused"}},m={button:"qq-upload-button-selector",alertDialog:"qq-alert-dialog-selector",dialogCancelButton:"qq-cancel-button-selector",confirmDialog:"qq-confirm-dialog-selector",dialogMessage:"qq-dialog-message-selector",dialogOkButton:"qq-ok-button-selector",promptDialog:"qq-prompt-dialog-selector",uploader:"qq-uploader-selector",drop:"qq-upload-drop-area-selector",list:"qq-upload-list-selector",progressBarContainer:"qq-progress-bar-container-selector",progressBar:"qq-progress-bar-selector",totalProgressBarContainer:"qq-total-progress-bar-container-selector",totalProgressBar:"qq-total-progress-bar-selector",file:"qq-upload-file-selector",spinner:"qq-upload-spinner-selector",size:"qq-upload-size-selector",cancel:"qq-upload-cancel-selector",pause:"qq-upload-pause-selector",continueButton:"qq-upload-continue-selector",deleteButton:"qq-upload-delete-selector",retry:"qq-upload-retry-selector",statusText:"qq-upload-status-text-selector",editFilenameInput:"qq-edit-filename-selector",editNameIcon:"qq-edit-filename-icon-selector",dropText:"qq-upload-drop-area-text-selector",dropProcessing:"qq-drop-processing-selector",dropProcessingSpinner:"qq-drop-processing-spinner-selector",thumbnail:"qq-thumbnail-selector"},b={},g=new qq.Promise,d=new qq.Promise,_,y,w,x,F,C,D,I,U=function(){var v=p.placeholders.thumbnailNotAvailable,E=p.placeholders.waitingForThumbnail,P={maxSize:u,scale:I};D&&(v?p.imageGenerator.generate(v,new Image,P).then(function(T){g.success(T)},function(){g.failure(),_("Problem loading 'not available' placeholder image at "+v,"error")}):g.failure(),E?p.imageGenerator.generate(E,new Image,P).then(function(T){d.success(T)},function(){d.failure(),_("Problem loading 'waiting for thumbnail' placeholder image at "+E,"error")}):d.failure())},A=function(v){var E=new qq.Promise;return d.then(function(P){le(P,v),v.src?E.success():(v.src=P.src,v.onload=function(){v.onload=null,H(v),E.success()})},function(){L(v),E.success()}),E},B=function(v,E,P){var T=Q(v);return _("Generating new thumbnail for "+v),E.qqThumbnailId=v,p.imageGenerator.generate(E,T,P).then(function(){S++,H(T),b[v].success()},function(){b[v].failure(),p.placeholders.waitUntilUpdate||J(v,T)})},j=function(){if(o.length){q=!0;var v=o.shift();v.update?pe(v):fe(v)}else q=!1},Y=function(v){return k(O(v),m.cancel)},W=function(v){return k(O(v),m.continueButton)},ne=function(v){return k(F,m[v+"Dialog"])},Z=function(v){return k(O(v),m.deleteButton)},ie=function(){return k(F,m.dropProcessing)},ae=function(v){return k(O(v),m.editNameIcon)},O=function(v){return f.map[v]||qq(C).getFirstByClass(n+v)},K=function(v){return k(O(v),m.file)},$=function(v){return k(O(v),m.pause)},ee=function(v){return v==null?k(F,m.totalProgressBarContainer)||k(F,m.totalProgressBar):k(O(v),m.progressBarContainer)||k(O(v),m.progressBar)},re=function(v){return k(O(v),m.retry)},se=function(v){return k(O(v),m.size)},te=function(v){return k(O(v),m.spinner)},k=function(v,E){return v&&qq(v).getFirstByClass(E)},Q=function(v){return D&&k(O(v),m.thumbnail)},L=function(v){v&&qq(v).addClass(p.classes.hide)},le=function(v,E){var P=v.style.maxWidth,T=v.style.maxHeight;T&&P&&!E.style.maxWidth&&!E.style.maxHeight&&qq(E).css({maxWidth:P,maxHeight:T})},J=function(v,E){var P=b[v]||new qq.Promise().failure(),T=new qq.Promise;return g.then(function(R){P.then(function(){T.success()},function(){le(R,E),E.onload=function(){E.onload=null,T.success()},E.src=R.src,H(E)})}),T},ce=function(){var v,E,P,T,R,N,z,M,X,G,V;if(_("Parsing template"),p.templateIdOrEl==null)throw new Error("You MUST specify either a template element or ID!");if(qq.isString(p.templateIdOrEl)){if(v=document.getElementById(p.templateIdOrEl),v===null)throw new Error(qq.format("Cannot find template script at ID '{}'!",p.templateIdOrEl));E=v.innerHTML}else{if(p.templateIdOrEl.innerHTML===void 0)throw new Error("You have specified an invalid value for the template option!  It must be an ID or an Element.");E=p.templateIdOrEl.innerHTML}if(E=qq.trimStr(E),T=document.createElement("div"),T.appendChild(qq.toElement(E)),V=qq(T).getFirstByClass(m.uploader),p.button&&(N=qq(T).getFirstByClass(m.button),N&&qq(N).remove()),(!qq.DragAndDrop||!qq.supportedFeatures.fileDrop)&&(X=qq(T).getFirstByClass(m.dropProcessing),X&&qq(X).remove()),z=qq(T).getFirstByClass(m.drop),z&&!qq.DragAndDrop&&(_("DnD module unavailable.","info"),qq(z).remove()),qq.supportedFeatures.fileDrop?qq(V).hasAttribute(l)&&z&&(G=qq(z).getFirstByClass(m.dropText),G&&qq(G).remove()):(V.removeAttribute(l),z&&qq(z).hasAttribute(r)&&qq(z).css({display:"none"})),M=qq(T).getFirstByClass(m.thumbnail),D?M&&(u=parseInt(M.getAttribute(i)),u=u>0?u:null,I=qq(M).hasAttribute(a)):M&&qq(M).remove(),D=D&&M,y=qq(T).getByClass(m.editFilenameInput).length>0,w=qq(T).getByClass(m.retry).length>0,P=qq(T).getFirstByClass(m.list),P==null)throw new Error("Could not find the file list container in the template!");return R=P.children[0].cloneNode(!0),P.innerHTML="",T.getElementsByTagName("DIALOG").length&&document.createElement("dialog"),_("Template parsing complete"),{template:T,fileTemplate:R}},de=function(v,E,P){var T=P,R=T.firstChild;E>0&&(R=qq(T).children()[E].nextSibling),T.insertBefore(v,R)},fe=function(v){var E=v.id,P=v.optFileOrBlob,T=P&&P.qqThumbnailId,R=Q(E),N={customResizeFunction:v.customResizeFunction,maxSize:u,orient:!0,scale:!0};qq.supportedFeatures.imagePreviews?R?p.limits.maxThumbs&&p.limits.maxThumbs<=S?(J(E,R),j()):A(R).done(function(){b[E]=new qq.Promise,b[E].done(function(){setTimeout(j,p.limits.timeBetweenThumbs)}),T!=null?he(E,T):B(E,P,N)}):j():R&&(A(R),j())},pe=function(v){var E=v.id,P=v.thumbnailUrl,T=v.showWaitingImg,R=Q(E),N={customResizeFunction:v.customResizeFunction,scale:I,maxSize:u};if(R)if(P)if(p.limits.maxThumbs&&p.limits.maxThumbs<=S)J(E,R),j();else return T&&A(R),p.imageGenerator.generate(P,R,N).then(function(){H(R),S++,setTimeout(j,p.limits.timeBetweenThumbs)},function(){J(E,R),setTimeout(j,p.limits.timeBetweenThumbs)});else J(E,R),j()},ue=function(v,E){var P=ee(v),T=v==null?m.totalProgressBar:m.progressBar;P&&!qq(P).hasClass(T)&&(P=qq(P).getFirstByClass(T)),P&&(qq(P).css({width:E+"%"}),P.setAttribute("aria-valuenow",E))},H=function(v){v&&qq(v).removeClass(p.classes.hide)},he=function(v,E){var P=Q(v),T=Q(E);_(qq.format("ID {} is the same file as ID {}.  Will use generated thumbnail from ID {} instead.",v,E,E)),b[E].then(function(){S++,b[v].success(),_(qq.format("Now using previously generated thumbnail created for ID {} on ID {}.",E,v)),P.src=T.src,H(P)},function(){b[v].failure(),p.placeholders.waitUntilUpdate||J(v,P)})};qq.extend(p,e),_=p.log,qq.supportedFeatures.imagePreviews||(p.limits.timeBetweenThumbs=0,p.limits.maxThumbs=0),F=p.containerEl,D=p.imageGenerator!==void 0,x=ce(),U(),qq.extend(this,{render:function(){_("Rendering template in DOM."),S=0,F.appendChild(x.template.cloneNode(!0)),L(ie()),this.hideTotalProgress(),C=p.fileContainerEl||k(F,m.list),_("Template rendering complete")},renderFailure:function(v){var E=qq.toElement(v);F.innerHTML="",F.appendChild(E)},reset:function(){F.innerHTML="",this.render()},clearFiles:function(){C.innerHTML=""},disableCancel:function(){h=!0},addFile:function(v,E,P,T,R){var N=x.fileTemplate.cloneNode(!0),z=k(N,m.file),M=k(F,m.uploader),X=R?f.content:C,G;R&&(f.map[v]=N),qq(N).addClass(n+v),M.removeAttribute(l),z&&(qq(z).setText(E),z.setAttribute("title",E)),N.setAttribute(t,v),P?de(N,P.index,X):X.appendChild(N),T?(N.style.display="none",qq(N).addClass(c)):(L(ee(v)),L(se(v)),L(Z(v)),L(re(v)),L($(v)),L(W(v)),h&&this.hideCancel(v),G=Q(v),G&&!G.src&&d.then(function(V){G.src=V.src,V.style.maxHeight&&V.style.maxWidth&&qq(G).css({maxHeight:V.style.maxHeight,maxWidth:V.style.maxWidth}),H(G)}))},addFileToCache:function(v,E,P,T){this.addFile(v,E,P,T,!0)},addCacheToDom:function(){C.appendChild(f.content),f.content=document.createDocumentFragment(),f.map={}},removeFile:function(v){qq(O(v)).remove()},getFileId:function(v){var E=v;if(E){for(;E.getAttribute(t)==null;)E=E.parentNode;return parseInt(E.getAttribute(t))}},getFileList:function(){return C},markFilenameEditable:function(v){var E=K(v);E&&qq(E).addClass(p.classes.editable)},updateFilename:function(v,E){var P=K(v);P&&(qq(P).setText(E),P.setAttribute("title",E))},hideFilename:function(v){L(K(v))},showFilename:function(v){H(K(v))},isFileName:function(v){return qq(v).hasClass(m.file)},getButton:function(){return p.button||k(F,m.button)},hideDropProcessing:function(){L(ie())},showDropProcessing:function(){H(ie())},getDropZone:function(){return k(F,m.drop)},isEditFilenamePossible:function(){return y},hideRetry:function(v){L(re(v))},isRetryPossible:function(){return w},showRetry:function(v){H(re(v))},getFileContainer:function(v){return O(v)},showEditIcon:function(v){var E=ae(v);E&&qq(E).addClass(p.classes.editable)},isHiddenForever:function(v){return qq(O(v)).hasClass(c)},hideEditIcon:function(v){var E=ae(v);E&&qq(E).removeClass(p.classes.editable)},isEditIcon:function(v){return qq(v).hasClass(m.editNameIcon,!0)},getEditInput:function(v){return k(O(v),m.editFilenameInput)},isEditInput:function(v){return qq(v).hasClass(m.editFilenameInput,!0)},updateProgress:function(v,E,P){var T=ee(v),R;T&&P>0&&(R=Math.round(E/P*100),R===100?L(T):H(T),ue(v,R))},updateTotalProgress:function(v,E){this.updateProgress(null,v,E)},hideProgress:function(v){var E=ee(v);E&&L(E)},hideTotalProgress:function(){this.hideProgress()},resetProgress:function(v){ue(v,0),this.hideTotalProgress(v)},resetTotalProgress:function(){this.resetProgress()},showCancel:function(v){if(!h){var E=Y(v);E&&qq(E).removeClass(p.classes.hide)}},hideCancel:function(v){L(Y(v))},isCancel:function(v){return qq(v).hasClass(m.cancel,!0)},allowPause:function(v){H($(v)),L(W(v))},uploadPaused:function(v){this.setStatusText(v,p.text.paused),this.allowContinueButton(v),L(te(v))},hidePause:function(v){L($(v))},isPause:function(v){return qq(v).hasClass(m.pause,!0)},isContinueButton:function(v){return qq(v).hasClass(m.continueButton,!0)},allowContinueButton:function(v){H(W(v)),L($(v))},uploadContinued:function(v){this.setStatusText(v,""),this.allowPause(v),H(te(v))},showDeleteButton:function(v){H(Z(v))},hideDeleteButton:function(v){L(Z(v))},isDeleteButton:function(v){return qq(v).hasClass(m.deleteButton,!0)},isRetry:function(v){return qq(v).hasClass(m.retry,!0)},updateSize:function(v,E){var P=se(v);P&&(H(P),qq(P).setText(E))},setStatusText:function(v,E){var P=k(O(v),m.statusText);P&&(E==null?qq(P).clearText():qq(P).setText(E))},hideSpinner:function(v){qq(O(v)).removeClass(s),L(te(v))},showSpinner:function(v){qq(O(v)).addClass(s),H(te(v))},generatePreview:function(v,E,P){this.isHiddenForever(v)||(o.push({id:v,customResizeFunction:P,optFileOrBlob:E}),!q&&j())},updateThumbnail:function(v,E,P,T){this.isHiddenForever(v)||(o.push({customResizeFunction:T,update:!0,id:v,thumbnailUrl:E,showWaitingImg:P}),!q&&j())},hasDialog:function(v){return qq.supportedFeatures.dialogElement&&!!ne(v)},showDialog:function(v,E,P){var T=ne(v),R=k(T,m.dialogMessage),N=T.getElementsByTagName("INPUT")[0],z=k(T,m.dialogCancelButton),M=k(T,m.dialogOkButton),X=new qq.Promise,G=function(){z.removeEventListener("click",V),M&&M.removeEventListener("click",oe),X.failure()},V=function(){z.removeEventListener("click",V),T.close()},oe=function(){T.removeEventListener("close",G),M.removeEventListener("click",oe),T.close(),X.success(N&&N.value)};return T.addEventListener("close",G),z.addEventListener("click",V),M&&M.addEventListener("click",oe),N&&(N.value=P),R.textContent=E,T.showModal(),X}})},qq.UiEventHandler=function(e,t){var n=new qq.DisposeSupport,i={eventType:"click",attachTo:null,onHandled:function(r,l){}};qq.extend(this,{addHandler:function(r){a(r)},dispose:function(){n.dispose()}});function a(r){n.attach(r,i.eventType,function(l){l=l||window.event;var s=l.target||l.srcElement;i.onHandled(s,l)})}qq.extend(t,{getFileIdFromItem:function(r){return r.qqFileId},getDisposeSupport:function(){return n}}),qq.extend(i,e),i.attachTo&&a(i.attachTo)},qq.FileButtonsClickHandler=function(e){var t={},n={templating:null,log:function(r,l){},onDeleteFile:function(r){},onCancel:function(r){},onRetry:function(r){},onPause:function(r){},onContinue:function(r){},onGetName:function(r){}},i={cancel:function(r){n.onCancel(r)},retry:function(r){n.onRetry(r)},deleteButton:function(r){n.onDeleteFile(r)},pause:function(r){n.onPause(r)},continueButton:function(r){n.onContinue(r)}};function a(r,l){qq.each(i,function(s,c){var f=s.charAt(0).toUpperCase()+s.slice(1),h;if(n.templating["is"+f](r))return h=n.templating.getFileId(r),qq.preventDefault(l),n.log(qq.format("Detected valid file button click event on file '{}', ID: {}.",n.onGetName(h),h)),c(h),!1})}qq.extend(n,e),n.eventType="click",n.onHandled=a,n.attachTo=n.templating.getFileList(),qq.extend(this,new qq.UiEventHandler(n,t))},qq.FilenameClickHandler=function(e){var t={},n={templating:null,log:function(a,r){},classes:{file:"qq-upload-file",editNameIcon:"qq-edit-filename-icon"},onGetUploadStatus:function(a){},onGetName:function(a){}};qq.extend(n,e);function i(a,r){if(n.templating.isFileName(a)||n.templating.isEditIcon(a)){var l=n.templating.getFileId(a),s=n.onGetUploadStatus(l);s===qq.status.SUBMITTED&&(n.log(qq.format("Detected valid filename click event on file '{}', ID: {}.",n.onGetName(l),l)),qq.preventDefault(r),t.handleFilenameEdit(l,a,!0))}}n.eventType="click",n.onHandled=i,qq.extend(this,new qq.FilenameEditHandler(n,t))},qq.FilenameInputFocusInHandler=function(e,t){var n={templating:null,onGetUploadStatus:function(a){},log:function(a,r){}};t||(t={});function i(a,r){if(n.templating.isEditInput(a)){var l=n.templating.getFileId(a),s=n.onGetUploadStatus(l);s===qq.status.SUBMITTED&&(n.log(qq.format("Detected valid filename input focus event on file '{}', ID: {}.",n.onGetName(l),l)),t.handleFilenameEdit(l,a))}}n.eventType="focusin",n.onHandled=i,qq.extend(n,e),qq.extend(this,new qq.FilenameEditHandler(n,t))},qq.FilenameInputFocusHandler=function(e){e.eventType="focus",e.attachTo=null,qq.extend(this,new qq.FilenameInputFocusInHandler(e,{}))},qq.FilenameEditHandler=function(e,t){var n={templating:null,log:function(c,f){},onGetUploadStatus:function(c){},onGetName:function(c){},onSetName:function(c,f){},onEditingStatusChange:function(c,f){}};function i(c){var f=n.onGetName(c),h=f.lastIndexOf(".");return h>0&&(f=f.substr(0,h)),f}function a(c){var f=n.onGetName(c);return qq.getExtension(f)}function r(c,f){var h=c.value,S;h!==void 0&&qq.trimStr(h).length>0&&(S=a(f),S!==void 0&&(h=h+"."+S),n.onSetName(f,h)),n.onEditingStatusChange(f,!1)}function l(c,f){t.getDisposeSupport().attach(c,"blur",function(){r(c,f)})}function s(c,f){t.getDisposeSupport().attach(c,"keyup",function(h){var S=h.keyCode||h.which;S===13&&r(c,f)})}qq.extend(n,e),n.attachTo=n.templating.getFileList(),qq.extend(this,new qq.UiEventHandler(n,t)),qq.extend(t,{handleFilenameEdit:function(c,f,h){var S=n.templating.getEditInput(c);n.onEditingStatusChange(c,!0),S.value=i(c),h&&S.focus(),l(S,c),s(S,c)}})}})(window)})(jquery_fineUploader);
